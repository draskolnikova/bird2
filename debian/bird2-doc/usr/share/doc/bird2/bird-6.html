<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 1.0.9">
 <TITLE>BIRD 2.0 User's Guide: Protocols</TITLE>
 <LINK HREF="bird-7.html" REL=next>
 <LINK HREF="bird-5.html" REL=previous>
 <LINK HREF="bird.html#toc6" REL=contents>
</HEAD>
<BODY>
<A HREF="bird-7.html">Next</A>
<A HREF="bird-5.html">Previous</A>
<A HREF="bird.html#toc6">Contents</A>
<HR>
<H2><A NAME="protocols"></A> <A NAME="s6">6.</A> <A HREF="bird.html#toc6">Protocols</A></H2>

<H2><A NAME="babel"></A> <A NAME="ss6.1">6.1</A> <A HREF="bird.html#toc6.1">Babel</A>
</H2>

<H3><A NAME="babel-intro"></A> Introduction</H3>

<P>The Babel protocol
(<A HREF="http://www.rfc-editor.org/info/rfc6126">RFC 6126</A>) is a loop-avoiding distance-vector routing protocol that is
robust and efficient both in ordinary wired networks and in wireless mesh
networks. Babel is conceptually very simple in its operation and "just works"
in its default configuration, though some configuration is possible and in some
cases desirable.
<P>
<P>The Babel protocol is dual stack; i.e., it can carry both IPv4 and IPv6
routes over the same IPv6 transport. For sending and receiving Babel packets,
only a link-local IPv6 address is needed.
<P>
<P>BIRD implements an extension for IPv6 source-specific routing (SSR or SADR),
but must be configured accordingly to use it. SADR-enabled Babel router can
interoperate with non-SADR Babel router, but the later would ignore routes
with specific (non-zero) source prefix.
<P>
<H3><A NAME="babel-config"></A> Configuration</H3>

<P>The Babel protocol support both IPv4 and IPv6 channels; both can be
configured simultaneously. It can also be configured with 
<A HREF="bird-2.html#ip-sadr-routes">IPv6 SADR</A> channel instead of regular IPv6
channel, in such case SADR support is enabled. Babel supports no global
configuration options apart from those common to all other protocols, but
supports the following per-interface configuration options:
<P>
<HR>
<PRE>
protocol babel [&lt;name>] {
        ipv4 { &lt;channel config> };
        ipv6 [sadr] { &lt;channel config> };
        randomize router id &lt;switch>;
        interface &lt;interface pattern> {
                type &lt;wired|wireless>;
                rxcost &lt;number>;
                limit &lt;number>;
                hello interval &lt;time>;
                update interval &lt;time>;
                port &lt;number>;
                tx class|dscp &lt;number>;
                tx priority &lt;number>;
                rx buffer &lt;number>;
                tx length &lt;number>;
                check link &lt;switch>;
                next hop ipv4 &lt;address>;
                next hop ipv6 &lt;address>;
        };
}
</PRE>
<HR>
<P>
<DL>
<DT><CODE>
<A NAME="babel-channel"></A> ipv4 | ipv6 [sadr] <I>channel config</I></CODE><DD><P>The supported channels are IPv4, IPv6, and IPv6 SADR.
<P>
<DT><CODE>
<A NAME="babel-random-router-id"></A> randomize router id <I>switch</I></CODE><DD><P>If enabled, Bird will randomize the top 32 bits of its router ID whenever
the protocol instance starts up. If a Babel node restarts, it loses its
sequence number, which can cause its routes to be rejected by peers until
the state is cleared out by other nodes in the network (which can take on
the order of minutes). Enabling this option causes Bird to pick a random
router ID every time it starts up, which avoids this problem at the cost
of not having stable router IDs in the network. Default: no.
<P>
<DT><CODE>
<A NAME="babel-type"></A> type wired|wireless </CODE><DD><P>This option specifies the interface type: Wired or wireless. On wired
interfaces a neighbor is considered unreachable after a small number of
Hello packets are lost, as described by <CODE>limit</CODE> option. On wireless
interfaces the ETX link quality estimation technique is used to compute
the metrics of routes discovered over this interface. This technique will
gradually degrade the metric of routes when packets are lost rather than
the more binary up/down mechanism of wired type links. Default:
<CODE>wired</CODE>.
<P>
<DT><CODE>
<A NAME="babel-rxcost"></A> rxcost <I>num</I></CODE><DD><P>This option specifies the nominal RX cost of the interface. The effective
neighbor costs for route metrics will be computed from this value with a
mechanism determined by the interface <CODE>type</CODE>. Note that in contrast to
other routing protocols like RIP or OSPF, the <CODE>rxcost</CODE> specifies the
cost of RX instead of TX, so it affects primarily neighbors' route
selection and not local route selection. Default: 96 for wired interfaces,
256 for wireless.
<P>
<DT><CODE>
<A NAME="babel-limit"></A> limit <I>num</I></CODE><DD><P>BIRD keeps track of received Hello messages from each neighbor to
establish neighbor reachability. For wired type interfaces, this option
specifies how many of last 16 hellos have to be correctly received in
order to neighbor is assumed to be up. The option is ignored on wireless
type interfaces, where gradual cost degradation is used instead of sharp
limit. Default: 12.
<P>
<DT><CODE>
<A NAME="babel-hello"></A> hello interval <I>time</I> s|ms</CODE><DD><P>Interval at which periodic Hello messages are sent on this interface,
with time units. Default: 4 seconds.
<P>
<DT><CODE>
<A NAME="babel-update"></A> update interval <I>time</I> s|ms</CODE><DD><P>Interval at which periodic (full) updates are sent, with time
units. Default: 4 times the hello interval.
<P>
<DT><CODE>
<A NAME="babel-port"></A> port <I>number</I></CODE><DD><P>This option selects an UDP port to operate on. The default is to operate
on port 6696 as specified in the Babel RFC.
<P>
<DT><CODE>
<A NAME="babel-tx-class"></A> tx class|dscp|priority <I>number</I></CODE><DD><P>These options specify the ToS/DiffServ/Traffic class/Priority of the
outgoing Babel packets. See 
<A HREF="bird-3.html#proto-tx-class">tx class</A> common
option for detailed description.
<P>
<DT><CODE>
<A NAME="babel-rx-buffer"></A> rx buffer <I>number</I></CODE><DD><P>This option specifies the size of buffers used for packet processing.
The buffer size should be bigger than maximal size of received packets.
The default value is the interface MTU, and the value will be clamped to a
minimum of 512 bytes + IP packet overhead.
<P>
<DT><CODE>
<A NAME="babel-tx-length"></A> tx length <I>number</I></CODE><DD><P>This option specifies the maximum length of generated Babel packets. To
avoid IP fragmentation, it should not exceed the interface MTU value.
The default value is the interface MTU value, and the value will be
clamped to a minimum of 512 bytes + IP packet overhead.
<P>
<DT><CODE>
<A NAME="babel-check-link"></A> check link <I>switch</I></CODE><DD><P>If set, the hardware link state (as reported by OS) is taken into
consideration. When the link disappears (e.g. an ethernet cable is
unplugged), neighbors are immediately considered unreachable and all
routes received from them are withdrawn. It is possible that some
hardware drivers or platforms do not implement this feature. Default:
yes.
<P>
<DT><CODE>
<A NAME="babel-next-hop-ipv4"></A> next hop ipv4 <I>address</I></CODE><DD><P>Set the next hop address advertised for IPv4 routes advertised on this
interface. Default: the preferred IPv4 address of the interface.
<P>
<DT><CODE>
<A NAME="babel-next-hop-ipv6"></A> next hop ipv6 <I>address</I></CODE><DD><P>Set the next hop address advertised for IPv6 routes advertised on this
interface. If not set, the same link-local address that is used as the
source for Babel packets will be used. In normal operation, it should not
be necessary to set this option.
</DL>
<P>
<H3><A NAME="babel-attr"></A> Attributes</H3>

<P>Babel defines just one attribute: the internal babel metric of the route. It
is exposed as the <CODE>babel_metric</CODE> attribute and has range from 1 to infinity
(65535).
<P>
<H3><A NAME="babel-exam"></A> Example</H3>

<P>
<HR>
<PRE>
protocol babel {
        interface "eth*" {
                type wired;
        };
        interface "wlan0", "wlan1" {
                type wireless;
                hello interval 1;
                rxcost 512;
        };
        interface "tap0";

        # This matches the default of babeld: redistribute all addresses
        # configured on local interfaces, plus re-distribute all routes received
        # from other babel peers.

        ipv4 {
                export where (source = RTS_DEVICE) || (source = RTS_BABEL);
        };
        ipv6 {
                export where (source = RTS_DEVICE) || (source = RTS_BABEL);
        };
}
</PRE>
<HR>
<P>
<H3><A NAME="babel-issues"></A> Known issues</H3>

<P>When retracting a route, Babel generates an unreachable route for a little
while (according to RFC). The interaction of this behavior with other protocols
is not well tested and strange things may happen.
<P>
<P>
<H2><A NAME="bfd"></A> <A NAME="ss6.2">6.2</A> <A HREF="bird.html#toc6.2">BFD</A>
</H2>

<H3><A NAME="bfd-intro"></A> Introduction</H3>

<P>Bidirectional Forwarding Detection (BFD) is not a routing protocol itself, it
is an independent tool providing liveness and failure detection. Routing
protocols like OSPF and BGP use integrated periodic "hello" messages to monitor
liveness of neighbors, but detection times of these mechanisms are high (e.g. 40
seconds by default in OSPF, could be set down to several seconds). BFD offers
universal, fast and low-overhead mechanism for failure detection, which could be
attached to any routing protocol in an advisory role.
<P>
<P>BFD consists of mostly independent BFD sessions. Each session monitors an
unicast bidirectional path between two BFD-enabled routers. This is done by
periodically sending control packets in both directions. BFD does not handle
neighbor discovery, BFD sessions are created on demand by request of other
protocols (like OSPF or BGP), which supply appropriate information like IP
addresses and associated interfaces. When a session changes its state, these
protocols are notified and act accordingly (e.g. break an OSPF adjacency when
the BFD session went down).
<P>
<P>BIRD implements basic BFD behavior as defined in <A HREF="http://www.rfc-editor.org/info/rfc5880">RFC 5880</A> (some
advanced features like the echo mode or authentication are not implemented), IP
transport for BFD as defined in <A HREF="http://www.rfc-editor.org/info/rfc5881">RFC 5881</A> and <A HREF="http://www.rfc-editor.org/info/rfc5883">RFC 5883</A> and
interaction with client protocols as defined in <A HREF="http://www.rfc-editor.org/info/rfc5882">RFC 5882</A>.
<P>
<P>BFD packets are sent with a dynamic source port number. Linux systems use by
default a bit different dynamic port range than the IANA approved one
(49152-65535). If you experience problems with compatibility, please adjust
<CODE>/proc/sys/net/ipv4/ip_local_port_range</CODE>.
<P>
<H3><A NAME="bfd-config"></A> Configuration</H3>

<P>BFD configuration consists mainly of multiple definitions of interfaces.
Most BFD config options are session specific. When a new session is requested
and dynamically created, it is configured from one of these definitions. For
sessions to directly connected neighbors, <CODE>interface</CODE> definitions are chosen
based on the interface associated with the session, while <CODE>multihop</CODE>
definition is used for multihop sessions. If no definition is relevant, the
session is just created with the default configuration. Therefore, an empty BFD
configuration is often sufficient.
<P>
<P>Note that to use BFD for other protocols like OSPF or BGP, these protocols
also have to be configured to request BFD sessions, usually by <CODE>bfd</CODE> option.
<P>
<P>A BFD instance not associated with any VRF handles session requests from all
other protocols, even ones associated with a VRF. Such setup would work for
single-hop BFD sessions if <CODE>net.ipv4.udp_l3mdev_accept</CODE> sysctl is enabled,
but does not currently work for multihop sessions. Another approach is to
configure multiple BFD instances, one for each VRF (including the default VRF).
Each BFD instance associated with a VRF (regular or default) only handles
session requests from protocols in the same VRF.
<P>
<P>Some of BFD session options require <I>time</I> value, which has to be specified
with the appropriate unit: <I>num</I> <CODE>s</CODE>|<CODE>ms</CODE>|<CODE>us</CODE>. Although microseconds
are allowed as units, practical minimum values are usually in order of tens of
milliseconds.
<P>
<HR>
<PRE>
protocol bfd [&lt;name&gt;] {
        interface &lt;interface pattern&gt; {
                interval &lt;time&gt;;
                min rx interval &lt;time&gt;;
                min tx interval &lt;time&gt;;
                idle tx interval &lt;time&gt;;
                multiplier &lt;num&gt;;
                passive &lt;switch&gt;;
                authentication none;
                authentication simple;
                authentication [meticulous] keyed md5|sha1;
                password "&lt;text&gt;";
                password "&lt;text&gt;" {
                        id &lt;num&gt;;
                        generate from "&lt;date&gt;";
                        generate to "&lt;date&gt;";
                        accept from "&lt;date&gt;";
                        accept to "&lt;date&gt;";
                        from "&lt;date&gt;";
                        to "&lt;date&gt;";
                };
        };
        multihop {
                interval &lt;time&gt;;
                min rx interval &lt;time&gt;;
                min tx interval &lt;time&gt;;
                idle tx interval &lt;time&gt;;
                multiplier &lt;num&gt;;
                passive &lt;switch&gt;;
        };
        neighbor &lt;ip&gt; [dev "&lt;interface&gt;"] [local &lt;ip&gt;] [multihop &lt;switch&gt;];
}
</PRE>
<HR>
<P>
<DL>
<DT><CODE>
<A NAME="bfd-iface"></A> interface <I>pattern</I> [, <I>...</I>] { <I>options</I> }</CODE><DD><P>Interface definitions allow to specify options for sessions associated
with such interfaces and also may contain interface specific options.
See 
<A HREF="bird-3.html#proto-iface">interface</A> common option for a detailed
description of interface patterns. Note that contrary to the behavior of
<CODE>interface</CODE> definitions of other protocols, BFD protocol would accept
sessions (in default configuration) even on interfaces not covered by
such definitions.
<P>
<DT><CODE>
<A NAME="bfd-multihop"></A> multihop { <I>options</I> }</CODE><DD><P>Multihop definitions allow to specify options for multihop BFD sessions,
in the same manner as <CODE>interface</CODE> definitions are used for directly
connected sessions. Currently only one such definition (for all multihop
sessions) could be used.
<P>
<DT><CODE>
<A NAME="bfd-neighbor"></A> neighbor <I>ip</I> [dev "<I>interface</I>"] [local <I>ip</I>] [multihop <I>switch</I>]</CODE><DD><P>BFD sessions are usually created on demand as requested by other
protocols (like OSPF or BGP). This option allows to explicitly add
a BFD session to the specified neighbor regardless of such requests.
<P>The session is identified by the IP address of the neighbor, with
optional specification of used interface and local IP. By default
the neighbor must be directly connected, unless the session is
configured as multihop. Note that local IP must be specified for
multihop sessions.
</DL>
<P>
<P>Session specific options (part of <CODE>interface</CODE> and <CODE>multihop</CODE> definitions):
<P>
<DL>
<DT><CODE>
<A NAME="bfd-interval"></A> interval <I>time</I></CODE><DD><P>BFD ensures availability of the forwarding path associated with the
session by periodically sending BFD control packets in both
directions. The rate of such packets is controlled by two options,
<CODE>min rx interval</CODE> and <CODE>min tx interval</CODE> (see below). This option
is just a shorthand to set both of these options together.
<P>
<DT><CODE>
<A NAME="bfd-min-rx-interval"></A> min rx interval <I>time</I></CODE><DD><P>This option specifies the minimum RX interval, which is announced to the
neighbor and used there to limit the neighbor's rate of generated BFD
control packets. Default: 10 ms.
<P>
<DT><CODE>
<A NAME="bfd-min-tx-interval"></A> min tx interval <I>time</I></CODE><DD><P>This option specifies the desired TX interval, which controls the rate
of generated BFD control packets (together with <CODE>min rx interval</CODE>
announced by the neighbor). Note that this value is used only if the BFD
session is up, otherwise the value of <CODE>idle tx interval</CODE> is used
instead. Default: 100 ms.
<P>
<DT><CODE>
<A NAME="bfd-idle-tx-interval"></A> idle tx interval <I>time</I></CODE><DD><P>In order to limit unnecessary traffic in cases where a neighbor is not
available or not running BFD, the rate of generated BFD control packets
is lower when the BFD session is not up. This option specifies the
desired TX interval in such cases instead of <CODE>min tx interval</CODE>.
Default: 1 s.
<P>
<DT><CODE>
<A NAME="bfd-multiplier"></A> multiplier <I>num</I></CODE><DD><P>Failure detection time for BFD sessions is based on established rate of
BFD control packets (<CODE>min rx/tx interval</CODE>) multiplied by this
multiplier, which is essentially (ignoring jitter) a number of missed
packets after which the session is declared down. Note that rates and
multipliers could be different in each direction of a BFD session.
Default: 5.
<P>
<DT><CODE>
<A NAME="bfd-passive"></A> passive <I>switch</I></CODE><DD><P>Generally, both BFD session endpoints try to establish the session by
sending control packets to the other side. This option allows to enable
passive mode, which means that the router does not send BFD packets
until it has received one from the other side. Default: disabled.
<P>
<DT><CODE>authentication none</CODE><DD><P>No passwords are sent in BFD packets. This is the default value.
<P>
<DT><CODE>authentication simple</CODE><DD><P>Every packet carries 16 bytes of password. Received packets lacking this
password are ignored. This authentication mechanism is very weak.
<P>
<DT><CODE>authentication [meticulous] keyed md5|sha1</CODE><DD><P>An authentication code is appended to each packet. The cryptographic
algorithm is keyed MD5 or keyed SHA-1. Note that the algorithm is common
for all keys (on one interface), in contrast to OSPF or RIP, where it
is a per-key option. Passwords (keys) are not sent open via network.
<P>The <CODE>meticulous</CODE> variant means that cryptographic sequence numbers
are increased for each sent packet, while in the basic variant they are
increased about once per second. Generally, the <CODE>meticulous</CODE> variant
offers better resistance to replay attacks but may require more
computation.
<P>
<DT><CODE>password "<I>text</I>"</CODE><DD><P>Specifies a password used for authentication. See 
<A HREF="bird-3.html#proto-pass">password</A> common option for detailed description. Note that
password option <CODE>algorithm</CODE> is not available in BFD protocol. The
algorithm is selected by <CODE>authentication</CODE> option for all passwords.
<P>
</DL>
<P>
<H3><A NAME="bfd-exam"></A> Example</H3>

<P>
<HR>
<PRE>
protocol bfd {
        interface "eth*" {
                min rx interval 20 ms;
                min tx interval 50 ms;
                idle tx interval 300 ms;
        };
        interface "gre*" {
                interval 200 ms;
                multiplier 10;
                passive;
        };
        multihop {
                interval 200 ms;
                multiplier 10;
        };

        neighbor 192.168.1.10;
        neighbor 192.168.2.2 dev "eth2";
        neighbor 192.168.10.1 local 192.168.1.1 multihop;
}
</PRE>
<HR>
<P>
<P>
<H2><A NAME="bgp"></A> <A NAME="ss6.3">6.3</A> <A HREF="bird.html#toc6.3">BGP</A>
</H2>

<P>The Border Gateway Protocol is the routing protocol used for backbone level
routing in the today's Internet. Contrary to other protocols, its convergence
does not rely on all routers following the same rules for route selection,
making it possible to implement any routing policy at any router in the network,
the only restriction being that if a router advertises a route, it must accept
and forward packets according to it.
<P>
<P>BGP works in terms of autonomous systems (often abbreviated as AS). Each AS
is a part of the network with common management and common routing policy. It is
identified by a unique 16-bit number (ASN). Routers within each AS usually
exchange AS-internal routing information with each other using an interior
gateway protocol (IGP, such as OSPF or RIP). Boundary routers at the border of
the AS communicate global (inter-AS) network reachability information with their
neighbors in the neighboring AS'es via exterior BGP (eBGP) and redistribute
received information to other routers in the AS via interior BGP (iBGP).
<P>
<P>Each BGP router sends to its neighbors updates of the parts of its routing
table it wishes to export along with complete path information (a list of AS'es
the packet will travel through if it uses the particular route) in order to
avoid routing loops.
<P>
<H3><A NAME="bgp-standards"></A> Supported standards</H3>

<P>
<UL>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc4271">RFC 4271</A> - Border Gateway Protocol 4 (BGP)</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc1997">RFC 1997</A> - BGP Communities Attribute</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc2385">RFC 2385</A> - Protection of BGP Sessions via TCP MD5 Signature</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc2545">RFC 2545</A> - Use of BGP Multiprotocol Extensions for IPv6</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc2918">RFC 2918</A> - Route Refresh Capability</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc3107">RFC 3107</A> - Carrying Label Information in BGP</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc4360">RFC 4360</A> - BGP Extended Communities Attribute</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc4364">RFC 4364</A> - BGP/MPLS IPv4 Virtual Private Networks</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc4456">RFC 4456</A> - BGP Route Reflection</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc4486">RFC 4486</A> - Subcodes for BGP Cease Notification Message</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc4659">RFC 4659</A> - BGP/MPLS IPv6 Virtual Private Networks</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc4724">RFC 4724</A> - Graceful Restart Mechanism for BGP</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc4760">RFC 4760</A> - Multiprotocol extensions for BGP</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc4798">RFC 4798</A> - Connecting IPv6 Islands over IPv4 MPLS</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc5065">RFC 5065</A> - AS confederations for BGP</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc5082">RFC 5082</A> - Generalized TTL Security Mechanism</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc5492">RFC 5492</A> - Capabilities Advertisement with BGP</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc5549">RFC 5549</A> - Advertising IPv4 NLRI with an IPv6 Next Hop</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc5575">RFC 5575</A> - Dissemination of Flow Specification Rules</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc5668">RFC 5668</A> - 4-Octet AS Specific BGP Extended Community</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc6286">RFC 6286</A> - AS-Wide Unique BGP Identifier</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc6608">RFC 6608</A> - Subcodes for BGP Finite State Machine Error</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc6793">RFC 6793</A> - BGP Support for 4-Octet AS Numbers</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc7311">RFC 7311</A> - Accumulated IGP Metric Attribute for BGP</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc7313">RFC 7313</A> - Enhanced Route Refresh Capability for BGP</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc7606">RFC 7606</A> - Revised Error Handling for BGP UPDATE Messages</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc7911">RFC 7911</A> - Advertisement of Multiple Paths in BGP</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc7947">RFC 7947</A> - Internet Exchange BGP Route Server</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc8092">RFC 8092</A> - BGP Large Communities Attribute</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc8203">RFC 8203</A> - BGP Administrative Shutdown Communication</LI>
<LI> <A HREF="http://www.rfc-editor.org/info/rfc8212">RFC 8212</A> - Default EBGP Route Propagation Behavior without Policies</LI>
</UL>
<P>
<H3><A NAME="bgp-route-select-rules"></A> Route selection rules</H3>

<P>BGP doesn't have any simple metric, so the rules for selection of an optimal
route among multiple BGP routes with the same preference are a bit more complex
and they are implemented according to the following algorithm. It starts the
first rule, if there are more "best" routes, then it uses the second rule to
choose among them and so on.
<P>
<UL>
<LI>Prefer route with the highest Local Preference attribute.</LI>
<LI>Prefer route with the shortest AS path.</LI>
<LI>Prefer IGP origin over EGP and EGP origin over incomplete.</LI>
<LI>Prefer the lowest value of the Multiple Exit Discriminator.</LI>
<LI>Prefer routes received via eBGP over ones received via iBGP.</LI>
<LI>Prefer routes with lower internal distance to a boundary router.</LI>
<LI>Prefer the route with the lowest value of router ID of the
advertising router.</LI>
</UL>
<P>
<H3><A NAME="bgp-igp-routing-table"></A> IGP routing table</H3>

<P>BGP is mainly concerned with global network reachability and with routes to
other autonomous systems. When such routes are redistributed to routers in the
AS via BGP, they contain IP addresses of a boundary routers (in route attribute
NEXT_HOP). BGP depends on existing IGP routing table with AS-internal routes to
determine immediate next hops for routes and to know their internal distances to
boundary routers for the purpose of BGP route selection. In BIRD, there is
usually one routing table used for both IGP routes and BGP routes.
<P>
<H3><A NAME="bgp-proto-config"></A> Protocol configuration</H3>

<P>Each instance of the BGP corresponds to one neighboring router. This allows
to set routing policy and all the other parameters differently for each neighbor
using the following configuration parameters:
<P>
<DL>
<DT><CODE>
<A NAME="bgp-local"></A> local [<I>ip</I>] [port <I>number</I>] [as <I>number</I>]</CODE><DD><P>Define which AS we are part of. (Note that contrary to other IP routers,
BIRD is able to act as a router located in multiple AS'es simultaneously,
but in such cases you need to tweak the BGP paths manually in the filters
to get consistent behavior.) Optional <CODE>ip</CODE> argument specifies a source
address, equivalent to the <CODE>source address</CODE> option (see below).
Optional <CODE>port</CODE> argument specifies the local BGP port instead of
standard port 179. The parameter may be used multiple times with
different sub-options (e.g., both <CODE>local 10.0.0.1 as 65000;</CODE> and
<CODE>local 10.0.0.1; local as 65000;</CODE> are valid). This parameter is
mandatory.
<P>
<DT><CODE>
<A NAME="bgp-neighbor"></A> neighbor [<I>ip</I> | range <I>prefix</I>] [port <I>number</I>] [as <I>number</I>] [internal|external]</CODE><DD><P>Define neighboring router this instance will be talking to and what AS
it is located in. In case the neighbor is in the same AS as we are, we
automatically switch to IBGP. Alternatively, it is possible to specify
just <CODE>internal</CODE> or <CODE>external</CODE> instead of AS number, in that case
either local AS number, or any external AS number is accepted.
Optionally, the remote port may also be specified. Like <CODE>local</CODE>
parameter, this parameter may also be used multiple times with different
sub-options. This parameter is mandatory.
<P>It is possible to specify network prefix (with <CODE>range</CODE> keyword)
instead of explicit neighbor IP address. This enables dynamic BGP
behavior, where the BGP instance listens on BGP port, but new BGP
instances are spawned for incoming BGP connections (if source address
matches the network prefix). It is possible to mix regular BGP instances
with dynamic BGP instances and have multiple dynamic BGP instances with
different ranges.
<P>
<DT><CODE>
<A NAME="bgp-iface"></A> interface <I>string</I></CODE><DD><P>Define interface we should use for link-local BGP IPv6 sessions.
Interface can also be specified as a part of <CODE>neighbor address</CODE>
(e.g., <CODE>neighbor fe80::1234%eth0 as 65000;</CODE>). The option may also be
used for non link-local sessions when it is necessary to explicitly
specify an interface, but only for direct (not multihop) sessions.
<P>
<DT><CODE>
<A NAME="bgp-direct"></A> direct</CODE><DD><P>Specify that the neighbor is directly connected. The IP address of the
neighbor must be from a directly reachable IP range (i.e. associated
with one of your router's interfaces), otherwise the BGP session
wouldn't start but it would wait for such interface to appear. The
alternative is the <CODE>multihop</CODE> option. Default: enabled for eBGP.
<P>
<DT><CODE>
<A NAME="bgp-multihop"></A> multihop [<I>number</I>]</CODE><DD><P>Configure multihop BGP session to a neighbor that isn't directly
connected. Accurately, this option should be used if the configured
neighbor IP address does not match with any local network subnets. Such
IP address have to be reachable through system routing table. The
alternative is the <CODE>direct</CODE> option. For multihop BGP it is
recommended to explicitly configure the source address to have it
stable. Optional <CODE>number</CODE> argument can be used to specify the number
of hops (used for TTL). Note that the number of networks (edges) in a
path is counted; i.e., if two BGP speakers are separated by one router,
the number of hops is 2. Default: enabled for iBGP.
<P>
<DT><CODE>
<A NAME="bgp-source-address"></A> source address <I>ip</I></CODE><DD><P>Define local address we should use as a source address for the BGP
session. Default: the address of the local end of the interface our
neighbor is connected to.
<P>
<DT><CODE>
<A NAME="bgp-dynamic-name"></A> dynamic name "<I>text</I>"</CODE><DD><P>Define common prefix of names used for new BGP instances spawned when
dynamic BGP behavior is active. Actual names also contain numeric
index to distinguish individual instances.  Default: "dynbgp".
<P>
<DT><CODE>
<A NAME="bgp-dynamic-name-digits"></A> dynamic name digits <I>number</I></CODE><DD><P>Define minimum number of digits for index in names of spawned dynamic
BGP instances. E.g., if set to 2, then the first name would be
"dynbgp01". Default: 0.
<P>
<DT><CODE>
<A NAME="bgp-strict-bind"></A> strict bind <I>switch</I></CODE><DD><P>Specify whether BGP listening socket should be bound to a specific local
address (the same as the <CODE>source address</CODE>) and associated interface,
or to all addresses. Binding to a specific address could be useful in
cases like running multiple BIRD instances on a machine, each using its
IP address. Note that listening sockets bound to a specific address and
to all addresses collide, therefore either all BGP protocols (of the
same address family and using the same local port) should have set
<CODE>strict bind</CODE>, or none of them. Default: disabled.
<P>
<DT><CODE>
<A NAME="bgp-check-link"></A> check link <I>switch</I></CODE><DD><P>BGP could use hardware link state into consideration.  If enabled,
BIRD tracks the link state of the associated interface and when link
disappears (e.g. an ethernet cable is unplugged), the BGP session is
immediately shut down. Note that this option cannot be used with
multihop BGP. Default: enabled for direct BGP, disabled otherwise.
<P>
<DT><CODE>
<A NAME="bgp-bfd"></A> bfd <I>switch</I>|graceful</CODE><DD><P>BGP could use BFD protocol as an advisory mechanism for neighbor
liveness and failure detection. If enabled, BIRD setups a BFD session
for the BGP neighbor and tracks its liveness by it. This has an
advantage of an order of magnitude lower detection times in case of
failure. When a neighbor failure is detected, the BGP session is
restarted. Optionally, it can be configured (by <CODE>graceful</CODE> argument)
to trigger graceful restart instead of regular restart. Note that BFD
protocol also has to be configured, see 
<A HREF="#bfd">BFD</A>
section for details. Default: disabled.
<P>
<DT><CODE>
<A NAME="bgp-ttl-security"></A> ttl security <I>switch</I></CODE><DD><P>Use GTSM (<A HREF="http://www.rfc-editor.org/info/rfc5082">RFC 5082</A> - the generalized TTL security mechanism). GTSM
protects against spoofed packets by ignoring received packets with a
smaller than expected TTL. To work properly, GTSM have to be enabled on
both sides of a BGP session. If both <CODE>ttl security</CODE> and
<CODE>multihop</CODE> options are enabled, <CODE>multihop</CODE> option should specify
proper hop value to compute expected TTL. Kernel support required:
Linux: 2.6.34+ (IPv4), 2.6.35+ (IPv6), BSD: since long ago, IPv4 only.
Note that full (ICMP protection, for example) <A HREF="http://www.rfc-editor.org/info/rfc5082">RFC 5082</A> support is
provided by Linux only. Default: disabled.
<P>
<DT><CODE>
<A NAME="bgp-password"></A> password <I>string</I></CODE><DD><P>Use this password for MD5 authentication of BGP sessions (<A HREF="http://www.rfc-editor.org/info/rfc2385">RFC 2385</A>). When
used on BSD systems, see also <CODE>setkey</CODE> option below. Default: no
authentication.
<P>
<DT><CODE>
<A NAME="bgp-setkey"></A> setkey <I>switch</I></CODE><DD><P>On BSD systems, keys for TCP MD5 authentication are stored in the global
SA/SP database, which can be accessed by external utilities (e.g.
setkey(8)). BIRD configures security associations in the SA/SP database
automatically based on <CODE>password</CODE> options (see above), this option
allows to disable automatic updates by BIRD when manual configuration by
external utilities is preferred. Note that automatic SA/SP database
updates are currently implemented only for FreeBSD. Passwords have to be
set manually by an external utility on NetBSD and OpenBSD. Default:
enabled (ignored on non-FreeBSD).
<P>
<DT><CODE>
<A NAME="bgp-passive"></A> passive <I>switch</I></CODE><DD><P>Standard BGP behavior is both initiating outgoing connections and
accepting incoming connections. In passive mode, outgoing connections
are not initiated. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-confederation"></A> confederation <I>number</I></CODE><DD><P>BGP confederations (<A HREF="http://www.rfc-editor.org/info/rfc5065">RFC 5065</A>) are collections of autonomous
systems that act as one entity to external systems, represented by one
confederation identifier (instead of AS numbers). This option allows to
enable BGP confederation behavior and to specify the local confederation
identifier. When BGP confederations are used, all BGP speakers that are
members of the BGP confederation should have the same confederation
identifier configured. Default: 0 (no confederation).
<P>
<DT><CODE>
<A NAME="bgp-confederation-member"></A> confederation member <I>switch</I></CODE><DD><P>When BGP confederations are used, this option allows to specify whether
the BGP neighbor is a member of the same confederation as the local BGP
speaker. The option is unnecessary (and ignored) for IBGP sessions, as
the same AS number implies the same confederation. Default: no.
<P>
<DT><CODE>
<A NAME="bgp-rr-client"></A> rr client</CODE><DD><P>Be a route reflector and treat the neighbor as a route reflection
client. Default: disabled.
<P>
<DT><CODE>
<A NAME="bgp-rr-cluster-id"></A> rr cluster id <I>IPv4 address</I></CODE><DD><P>Route reflectors use cluster id to avoid route reflection loops. When
there is one route reflector in a cluster it usually uses its router id
as a cluster id, but when there are more route reflectors in a cluster,
these need to be configured (using this option) to use a common cluster
id. Clients in a cluster need not know their cluster id and this option
is not allowed for them. Default: the same as router id.
<P>
<DT><CODE>
<A NAME="bgp-rs-client"></A> rs client</CODE><DD><P>Be a route server and treat the neighbor as a route server client.
A route server is used as a replacement for full mesh EBGP routing in
Internet exchange points in a similar way to route reflectors used in
IBGP routing. BIRD does not implement obsoleted <A HREF="http://www.rfc-editor.org/info/rfc1863">RFC 1863</A>, but
uses ad-hoc implementation, which behaves like plain EBGP but reduces
modifications to advertised route attributes to be transparent (for
example does not prepend its AS number to AS PATH attribute and
keeps MED attribute). Default: disabled.
<P>
<DT><CODE>
<A NAME="bgp-allow-local-pref"></A> allow bgp_local_pref <I>switch</I></CODE><DD><P>A standard BGP implementation do not send the Local Preference attribute
to eBGP neighbors and ignore this attribute if received from eBGP
neighbors, as per <A HREF="http://www.rfc-editor.org/info/rfc4271">RFC 4271</A>.  When this option is enabled on an
eBGP session, this attribute will be sent to and accepted from the peer,
which is useful for example if you have a setup like in <A HREF="http://www.rfc-editor.org/info/rfc7938">RFC 7938</A>.
The option does not affect iBGP sessions. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-allow-local-as"></A> allow local as [<I>number</I>]</CODE><DD><P>BGP prevents routing loops by rejecting received routes with the local
AS number in the AS path. This option allows to loose or disable the
check. Optional <CODE>number</CODE> argument can be used to specify the maximum
number of local ASNs in the AS path that is allowed for received
routes. When the option is used without the argument, the check is
completely disabled and you should ensure loop-free behavior by some
other means. Default: 0 (no local AS number allowed).
<P>
<DT><CODE>
<A NAME="bgp-enable-route-refresh"></A> enable route refresh <I>switch</I></CODE><DD><P>After the initial route exchange, BGP protocol uses incremental updates
to keep BGP speakers synchronized. Sometimes (e.g., if BGP speaker
changes its import filter, or if there is suspicion of inconsistency) it
is necessary to do a new complete route exchange. BGP protocol extension
Route Refresh (<A HREF="http://www.rfc-editor.org/info/rfc2918">RFC 2918</A>) allows BGP speaker to request
re-advertisement of all routes from its neighbor. BGP protocol
extension Enhanced Route Refresh (<A HREF="http://www.rfc-editor.org/info/rfc7313">RFC 7313</A>) specifies explicit
begin and end for such exchanges, therefore the receiver can remove
stale routes that were not advertised during the exchange. This option
specifies whether BIRD advertises these capabilities and supports
related procedures. Note that even when disabled, BIRD can send route
refresh requests.  Default: on.
<P>
<DT><CODE>
<A NAME="bgp-graceful-restart"></A> graceful restart <I>switch</I>|aware</CODE><DD><P>When a BGP speaker restarts or crashes, neighbors will discard all
received paths from the speaker, which disrupts packet forwarding even
when the forwarding plane of the speaker remains intact. <A HREF="http://www.rfc-editor.org/info/rfc4724">RFC 4724</A>
specifies an optional graceful restart mechanism to alleviate this
issue. This option controls the mechanism. It has three states:
Disabled, when no support is provided. Aware, when the graceful restart
support is announced and the support for restarting neighbors is
provided, but no local graceful restart is allowed (i.e. receiving-only
role). Enabled, when the full graceful restart support is provided
(i.e. both restarting and receiving role). Restarting role could be also
configured per-channel. Note that proper support for local graceful
restart requires also configuration of other protocols. Default: aware.
<P>
<DT><CODE>
<A NAME="bgp-graceful-restart-time"></A> graceful restart time <I>number</I></CODE><DD><P>The restart time is announced in the BGP graceful restart capability
and specifies how long the neighbor would wait for the BGP session to
re-establish after a restart before deleting stale routes. Default:
120 seconds.
<P>
<DT><CODE>
<A NAME="bgp-long-lived-graceful-restart"></A> long lived graceful restart <I>switch</I>|aware</CODE><DD><P>The long-lived graceful restart is an extension of the traditional
<A HREF="#bgp-graceful-restart">BGP graceful restart</A>, where stale
routes are kept even after the 
<A HREF="#bgp-graceful-restart-time">restart time</A> expires for additional long-lived stale time, but
they are marked with the LLGR_STALE community, depreferenced, and
withdrawn from routers not supporting LLGR. Like traditional BGP
graceful restart, it has three states: disabled, aware (receiving-only),
and enabled. Note that long-lived graceful restart requires at least
aware level of traditional BGP graceful restart. Default: aware, unless
graceful restart is disabled.
<P>
<DT><CODE>
<A NAME="bgp-long-lived-stale-time"></A> long lived stale time <I>number</I></CODE><DD><P>The long-lived stale time is announced in the BGP long-lived graceful
restart capability and specifies how long the neighbor would keep stale
routes depreferenced during long-lived graceful restart until either the
session is re-stablished and synchronized or the stale time expires and
routes are removed. Default: 3600 seconds.
<P>
<DT><CODE>
<A NAME="bgp-interpret-communities"></A> interpret communities <I>switch</I></CODE><DD><P><A HREF="http://www.rfc-editor.org/info/rfc1997">RFC 1997</A> demands that BGP speaker should process well-known
communities like no-export (65535, 65281) or no-advertise (65535,
65282). For example, received route carrying a no-adverise community
should not be advertised to any of its neighbors. If this option is
enabled (which is by default), BIRD has such behavior automatically (it
is evaluated when a route is exported to the BGP protocol just before
the export filter).  Otherwise, this integrated processing of
well-known communities is disabled. In that case, similar behavior can
be implemented in the export filter.  Default: on.
<P>
<DT><CODE>
<A NAME="bgp-enable-as4"></A> enable as4 <I>switch</I></CODE><DD><P>BGP protocol was designed to use 2B AS numbers and was extended later to
allow 4B AS number. BIRD supports 4B AS extension, but by disabling this
option it can be persuaded not to advertise it and to maintain old-style
sessions with its neighbors. This might be useful for circumventing bugs
in neighbor's implementation of 4B AS extension. Even when disabled
(off), BIRD behaves internally as AS4-aware BGP router. Default: on.
<P>
<DT><CODE>
<A NAME="bgp-enable-extended-messages"></A> enable extended messages <I>switch</I></CODE><DD><P>The BGP protocol uses maximum message length of 4096 bytes. This option
provides an extension to allow extended messages with length up
to 65535 bytes. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-capabilities"></A> capabilities <I>switch</I></CODE><DD><P>Use capability advertisement to advertise optional capabilities. This is
standard behavior for newer BGP implementations, but there might be some
older BGP implementations that reject such connection attempts. When
disabled (off), features that request it (4B AS support) are also
disabled. Default: on, with automatic fallback to off when received
capability-related error.
<P>
<DT><CODE>
<A NAME="bgp-advertise-ipv4"></A> advertise ipv4 <I>switch</I></CODE><DD><P>Advertise IPv4 multiprotocol capability. This is not a correct behavior
according to the strict interpretation of <A HREF="http://www.rfc-editor.org/info/rfc4760">RFC 4760</A>, but it is
widespread and required by some BGP implementations (Cisco and Quagga).
This option is relevant to IPv4 mode with enabled capability
advertisement only. Default: on.
<P>
<DT><CODE>
<A NAME="bgp-disable-after-error"></A> disable after error <I>switch</I></CODE><DD><P>When an error is encountered (either locally or by the other side),
disable the instance automatically and wait for an administrator to fix
the problem manually. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-disable-after-cease"></A> disable after cease <I>switch</I>|<I>set-of-flags</I></CODE><DD><P>When a Cease notification is received, disable the instance
automatically and wait for an administrator to fix the problem manually.
When used with <I>switch</I> argument, it means handle every Cease subtype
with the exception of <CODE>connection collision</CODE>. Default: off.
<P>The <I>set-of-flags</I> allows to narrow down relevant Cease subtypes. The
syntax is <CODE>{<I>flag</I> [, <I>...</I>] }</CODE>, where flags are: <CODE>cease</CODE>,
<CODE>prefix limit hit</CODE>, <CODE>administrative shutdown</CODE>,
<CODE>peer deconfigured</CODE>, <CODE>administrative reset</CODE>,
<CODE>connection rejected</CODE>, <CODE>configuration change</CODE>,
<CODE>connection collision</CODE>, <CODE>out of resources</CODE>.
<P>
<DT><CODE>
<A NAME="bgp-hold-time"></A> hold time <I>number</I></CODE><DD><P>Time in seconds to wait for a Keepalive message from the other side
before considering the connection stale. Default: depends on agreement
with the neighboring router, we prefer 240 seconds if the other side is
willing to accept it.
<P>
<DT><CODE>
<A NAME="bgp-startup-hold-time"></A> startup hold time <I>number</I></CODE><DD><P>Value of the hold timer used before the routers have a chance to exchange
open messages and agree on the real value. Default: 240 seconds.
<P>
<DT><CODE>
<A NAME="bgp-keepalive-time"></A> keepalive time <I>number</I></CODE><DD><P>Delay in seconds between sending of two consecutive Keepalive messages.
Default: One third of the hold time.
<P>
<DT><CODE>
<A NAME="bgp-connect-delay-time"></A> connect delay time <I>number</I></CODE><DD><P>Delay in seconds between protocol startup and the first attempt to
connect. Default: 5 seconds.
<P>
<DT><CODE>
<A NAME="bgp-connect-retry-time"></A> connect retry time <I>number</I></CODE><DD><P>Time in seconds to wait before retrying a failed attempt to connect.
Default: 120 seconds.
<P>
<DT><CODE>
<A NAME="bgp-error-wait-time"></A> error wait time <I>number</I>,<I>number</I></CODE><DD><P>Minimum and maximum delay in seconds between a protocol failure (either
local or reported by the peer) and automatic restart. Doesn't apply
when <CODE>disable after error</CODE> is configured. If consecutive errors
happen, the delay is increased exponentially until it reaches the
maximum. Default: 60, 300.
<P>
<DT><CODE>
<A NAME="bgp-error-forget-time"></A> error forget time <I>number</I></CODE><DD><P>Maximum time in seconds between two protocol failures to treat them as a
error sequence which makes <CODE>error wait time</CODE> increase exponentially.
Default: 300 seconds.
<P>
<DT><CODE>
<A NAME="bgp-path-metric"></A> path metric <I>switch</I></CODE><DD><P>Enable comparison of path lengths when deciding which BGP route is the
best one. Default: on.
<P>
<DT><CODE>
<A NAME="bgp-med-metric"></A> med metric <I>switch</I></CODE><DD><P>Enable comparison of MED attributes (during best route selection) even
between routes received from different ASes. This may be useful if all
MED attributes contain some consistent metric, perhaps enforced in
import filters of AS boundary routers. If this option is disabled, MED
attributes are compared only if routes are received from the same AS
(which is the standard behavior). Default: off.
<P>
<DT><CODE>
<A NAME="bgp-deterministic-med"></A> deterministic med <I>switch</I></CODE><DD><P>BGP route selection algorithm is often viewed as a comparison between
individual routes (e.g. if a new route appears and is better than the
current best one, it is chosen as the new best one). But the proper
route selection, as specified by <A HREF="http://www.rfc-editor.org/info/rfc4271">RFC 4271</A>, cannot be fully
implemented in that way. The problem is mainly in handling the MED
attribute. BIRD, by default, uses an simplification based on individual
route comparison, which in some cases may lead to temporally dependent
behavior (i.e. the selection is dependent on the order in which routes
appeared). This option enables a different (and slower) algorithm
implementing proper <A HREF="http://www.rfc-editor.org/info/rfc4271">RFC 4271</A> route selection, which is
deterministic. Alternative way how to get deterministic behavior is to
use <CODE>med metric</CODE> option. This option is incompatible with 
<A HREF="bird-2.html#dsc-table-sorted">sorted tables</A>.  Default: off.
<P>
<DT><CODE>
<A NAME="bgp-igp-metric"></A> igp metric <I>switch</I></CODE><DD><P>Enable comparison of internal distances to boundary routers during best
route selection. Default: on.
<P>
<DT><CODE>
<A NAME="bgp-prefer-older"></A> prefer older <I>switch</I></CODE><DD><P>Standard route selection algorithm breaks ties by comparing router IDs.
This changes the behavior to prefer older routes (when both are external
and from different peer). For details, see <A HREF="http://www.rfc-editor.org/info/rfc5004">RFC 5004</A>. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-default-med"></A> default bgp_med <I>number</I></CODE><DD><P>Value of the Multiple Exit Discriminator to be used during route
selection when the MED attribute is missing. Default: 0.
<P>
<DT><CODE>
<A NAME="bgp-default-local-pref"></A> default bgp_local_pref <I>number</I></CODE><DD><P>A default value for the Local Preference attribute. It is used when
a new Local Preference attribute is attached to a route by the BGP
protocol itself (for example, if a route is received through eBGP and
therefore does not have such attribute). Default: 100 (0 in pre-1.2.0
versions of BIRD).
</DL>
<P>
<H3><A NAME="bgp-channel-config"></A> Channel configuration</H3>

<P>BGP supports several AFIs and SAFIs over one connection. Every AFI/SAFI
announced to the peer corresponds to one channel. The table of supported AFI/SAFIs
together with their appropriate channels follows.
<P>
<CENTER><TABLE BORDER><TR><TD>
<BR>
<B>Channel name</B> </TD><TD> <B>Table nettype</B> </TD><TD> <B>IGP table allowed</B> </TD><TD> <B>AFI</B> </TD><TD> <B>SAFI</B></TD></TR><TR><TD>
<CODE>ipv4</CODE> </TD><TD> <CODE>ipv4</CODE> </TD><TD> <CODE>ipv4</CODE> and <CODE>ipv6</CODE> </TD><TD> 1 </TD><TD> 1</TD></TR><TR><TD>
 <CODE>ipv6</CODE> </TD><TD> <CODE>ipv6</CODE> </TD><TD> <CODE>ipv4</CODE> and <CODE>ipv6</CODE> </TD><TD> 2 </TD><TD> 1</TD></TR><TR><TD>
 <CODE>ipv4 multicast</CODE> </TD><TD> <CODE>ipv4</CODE> </TD><TD> <CODE>ipv4</CODE> and <CODE>ipv6</CODE> </TD><TD> 1 </TD><TD> 2</TD></TR><TR><TD>
 <CODE>ipv6 multicast</CODE> </TD><TD> <CODE>ipv6</CODE> </TD><TD> <CODE>ipv4</CODE> and <CODE>ipv6</CODE> </TD><TD> 2 </TD><TD> 2</TD></TR><TR><TD>
 <CODE>ipv4 mpls</CODE> </TD><TD> <CODE>ipv4</CODE> </TD><TD> <CODE>ipv4</CODE> and <CODE>ipv6</CODE> </TD><TD> 1 </TD><TD> 4</TD></TR><TR><TD>
 <CODE>ipv6 mpls</CODE> </TD><TD> <CODE>ipv6</CODE> </TD><TD> <CODE>ipv4</CODE> and <CODE>ipv6</CODE> </TD><TD> 2 </TD><TD> 4</TD></TR><TR><TD>
 <CODE>vpn4 mpls</CODE> </TD><TD> <CODE>vpn4</CODE> </TD><TD> <CODE>ipv4</CODE> and <CODE>ipv6</CODE> </TD><TD> 1 </TD><TD> 128</TD></TR><TR><TD>
 <CODE>vpn6 mpls</CODE> </TD><TD> <CODE>vpn6</CODE> </TD><TD> <CODE>ipv4</CODE> and <CODE>ipv6</CODE> </TD><TD> 2 </TD><TD> 128</TD></TR><TR><TD>
 <CODE>vpn4 multicast</CODE> </TD><TD> <CODE>vpn4</CODE> </TD><TD> <CODE>ipv4</CODE> and <CODE>ipv6</CODE> </TD><TD> 1 </TD><TD> 129</TD></TR><TR><TD>
 <CODE>vpn6 multicast</CODE> </TD><TD> <CODE>vpn6</CODE> </TD><TD> <CODE>ipv4</CODE> and <CODE>ipv6</CODE> </TD><TD> 2 </TD><TD> 129</TD></TR><TR><TD>
 <CODE>flow4</CODE> </TD><TD> <CODE>flow4</CODE> </TD><TD> --- </TD><TD> 1 </TD><TD> 133</TD></TR><TR><TD>
 <CODE>flow6</CODE> </TD><TD> <CODE>flow6</CODE> </TD><TD> --- </TD><TD> 2 </TD><TD> 133

</TD></TR></TABLE></CENTER>
<P>
<P>Due to <A HREF="http://www.rfc-editor.org/info/rfc8212">RFC 8212</A>, external BGP protocol requires explicit configuration
of import and export policies (in contrast to other protocols, where default
policies of <CODE>import all</CODE> and <CODE>export none</CODE> are used in absence of explicit
configuration). Note that blanket policies like <CODE>all</CODE> or <CODE>none</CODE> can still
be used in explicit configuration.
<P>
<P>BGP channels have additional config options (together with the common ones):
<P>
<DL>
<DT><CODE>
<A NAME="bgp-mandatory"></A> mandatory <I>switch</I></CODE><DD><P>When local and neighbor sets of configured AFI/SAFI pairs differ,
capability negotiation ensures that a common subset is used. For
mandatory channels their associated AFI/SAFI must be negotiated
(i.e., also announced by the neighbor), otherwise BGP session
negotiation fails with <I>'Required capability missing'</I> error.
Regardless, at least one AFI/SAFI must be negotiated in order to BGP
session be successfully established. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-next-hop-keep"></A> next hop keep <I>switch</I>|ibgp|ebgp</CODE><DD><P>Do not modify the Next Hop attribute and advertise the current one
unchanged even in cases where our own local address should be used
instead. This is necessary when the BGP speaker does not forward network
traffic (route servers and some route reflectors) and also can be useful
in some other cases (e.g. multihop EBGP sessions). Can be enabled for
all routes, or just for routes received from IBGP / EBGP neighbors.
Default: disabled for regular BGP, enabled for route servers,
<CODE>ibgp</CODE> for route reflectors.
<P>
<DT><CODE>
<A NAME="bgp-next-hop-self"></A> next hop self <I>switch</I>|ibgp|ebgp</CODE><DD><P>Always advertise our own local address as a next hop, even in cases
where the current Next Hop attribute should be used unchanged. This is
sometimes used for routes propagated from EBGP to IBGP when IGP routing
does not cover inter-AS links, therefore IP addreses of EBGP neighbors
are not resolvable through IGP. Can be enabled for all routes, or just
for routes received from IBGP / EBGP neighbors. Default: disabled.
<P>
<DT><CODE>
<A NAME="bgp-next-hop-address"></A> next hop address <I>ip</I></CODE><DD><P>Specify which address to use when our own local address should be
announced in the Next Hop attribute. Default: the source address of the
BGP session (if acceptable), or the preferred address of an associated
interface.
<P>
<DT><CODE>
<A NAME="bgp-missing-lladdr"></A> missing lladdr self|drop|ignore</CODE><DD><P>Next Hop attribute in BGP-IPv6 sometimes contains just the global IPv6
address, but sometimes it has to contain both global and link-local IPv6
addresses. This option specifies what to do if BIRD have to send both
addresses but does not know link-local address. This situation might
happen when routes from other protocols are exported to BGP, or when
improper updates are received from BGP peers. <CODE>self</CODE> means that BIRD
advertises its own local address instead. <CODE>drop</CODE> means that BIRD
skips that prefixes and logs error. <CODE>ignore</CODE> means that BIRD ignores
the problem and sends just the global address (and therefore forms
improper BGP update). Default: <CODE>self</CODE>, unless BIRD is configured as a
route server (option <CODE>rs client</CODE>), in that case default is <CODE>ignore</CODE>,
because route servers usually do not forward packets themselves.
<P>
<DT><CODE>
<A NAME="bgp-gateway"></A> gateway direct|recursive</CODE><DD><P>For received routes, their <CODE>gw</CODE> (immediate next hop) attribute is
computed from received <CODE>bgp_next_hop</CODE> attribute. This option
specifies how it is computed. Direct mode means that the IP address from
<CODE>bgp_next_hop</CODE> is used if it is directly reachable, otherwise the
neighbor IP address is used. Recursive mode means that the gateway is
computed by an IGP routing table lookup for the IP address from
<CODE>bgp_next_hop</CODE>. Note that there is just one level of indirection in
recursive mode - the route obtained by the lookup must not be recursive
itself, to prevent mutually recursive routes.
<P>Recursive mode is the behavior specified by the BGP
standard. Direct mode is simpler, does not require any routes in a
routing table, and was used in older versions of BIRD, but does not
handle well nontrivial iBGP setups and multihop. Recursive mode is
incompatible with 
<A HREF="bird-2.html#dsc-table-sorted">sorted tables</A>. Default:
<CODE>direct</CODE> for direct sessions, <CODE>recursive</CODE> for multihop sessions.
<P>
<DT><CODE>
<A NAME="bgp-igp-table"></A> igp table <I>name</I></CODE><DD><P>Specifies a table that is used as an IGP routing table. The type of this
table must be as allowed in the table above. This option is allowed once
for every allowed table type. Default: the same as the main table
the channel is connected to (if eligible).
<P>
<DT><CODE>
<A NAME="bgp-import-table"></A> import table <I>switch</I></CODE><DD><P>A BGP import table contains all received routes from given BGP neighbor,
before application of import filters. It is also called <EM>Adj-RIB-In</EM>
in BGP terminology. BIRD BGP by default operates without import tables,
in which case received routes are just processed by import filters,
accepted ones are stored in the master table, and the rest is forgotten.
Enabling <CODE>import table</CODE> allows to store unprocessed routes, which can
be examined later by <CODE>show route</CODE>, and can be used to reconfigure
import filters without full route refresh. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-export-table"></A> export table <I>switch</I></CODE><DD><P>A BGP export table contains all routes sent to given BGP neighbor, after
application of export filters. It is also called <EM>Adj-RIB-Out</EM> in BGP
terminology. BIRD BGP by default operates without export tables, in
which case routes from master table are just processed by export filters
and then announced by BGP. Enabling <CODE>export table</CODE> allows to store
routes after export filter processing, so they can be examined later by
<CODE>show route</CODE>, and can be used to eliminate unnecessary updates or
withdraws. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-secondary"></A> secondary <I>switch</I></CODE><DD><P>Usually, if an export filter rejects a selected route, no other route is
propagated for that network. This option allows to try the next route in
order until one that is accepted is found or all routes for that network
are rejected. This can be used for route servers that need to propagate
different tables to each client but do not want to have these tables
explicitly (to conserve memory). This option requires that the connected
routing table is 
<A HREF="bird-2.html#dsc-table-sorted">sorted</A>. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-extended-next-hop"></A> extended next hop <I>switch</I></CODE><DD><P>BGP expects that announced next hops have the same address family as
associated network prefixes. This option provides an extension to use
IPv4 next hops with IPv6 prefixes and vice versa. For IPv4 / VPNv4
channels, the behavior is controlled by the Extended Next Hop Encoding
capability, as described in <A HREF="http://www.rfc-editor.org/info/rfc5549">RFC 5549</A>. For IPv6 / VPNv6 channels,
just IPv4-mapped IPv6 addresses are used, as described in
<A HREF="http://www.rfc-editor.org/info/rfc4798">RFC 4798</A> and <A HREF="http://www.rfc-editor.org/info/rfc4659">RFC 4659</A>. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-add-paths"></A> add paths <I>switch</I>|rx|tx</CODE><DD><P>Standard BGP can propagate only one path (route) per destination network
(usually the selected one). This option controls the add-path protocol
extension, which allows to advertise any number of paths to a
destination. Note that to be active, add-path has to be enabled on both
sides of the BGP session, but it could be enabled separately for RX and
TX direction. When active, all available routes accepted by the export
filter are advertised to the neighbor. Default: off.
<P>
<DT><CODE>
<A NAME="bgp-aigp"></A> aigp <I>switch</I>|originate</CODE><DD><P>The BGP protocol does not use a common metric like other routing
protocols, instead it uses a set of criteria for route selection
consisting both overall AS path length and a distance to the nearest AS
boundary router. Assuming that metrics of different autonomous systems
are incomparable, once a route is propagated from an AS to a next one,
the distance in the old AS does not matter.
<P>The AIGP extension (<A HREF="http://www.rfc-editor.org/info/rfc7311">RFC 7311</A>) allows to propagate accumulated
IGP metric (in the AIGP attribute) through both IBGP and EBGP links,
computing total distance through multiple autonomous systems (assuming
they use comparable IGP metric). The total AIGP metric is compared in
the route selection process just after Local Preference comparison (and
before AS path length comparison).
<P>This option controls whether AIGP attribute propagation is allowed on
the session. Optionally, it can be set to <CODE>originate</CODE>, which not only
allows AIGP attribute propagation, but also new AIGP attributes are
automatically attached to non-BGP routes with valid IGP metric (e.g.
<CODE>ospf_metric1</CODE>) as they are exported to the BGP session. Default:
enabled for IBGP (and intra-confederation EBGP), disabled for regular
EBGP.
<P>
<DT><CODE>
<A NAME="bgp-cost"></A> cost <I>number</I></CODE><DD><P>When BGP 
<A HREF="#bgp-gateway">gateway mode</A> is <CODE>recursive</CODE>
(mainly multihop IBGP sessions), then the distance to BGP next hop is
based on underlying IGP metric. This option specifies the distance to
BGP next hop for BGP sessions in direct gateway mode (mainly direct
EBGP sessions).
<P>
<DT><CODE>
<A NAME="bgp-graceful-restart-c"></A> graceful restart <I>switch</I></CODE><DD><P>Although BGP graceful restart is configured mainly by protocol-wide
<A HREF="#bgp-graceful-restart">options</A>, it is possible to
configure restarting role per AFI/SAFI pair by this channel option.
The option is ignored if graceful restart is disabled by protocol-wide
option. Default: off in aware mode, on in full mode.
<P>
<DT><CODE>
<A NAME="bgp-long-lived-graceful-restart-c"></A> long lived graceful restart <I>switch</I></CODE><DD><P>BGP long-lived graceful restart is configured mainly by protocol-wide
<A HREF="#bgp-long-lived-graceful-restart">options</A>, but the
restarting role can be set per AFI/SAFI pair by this channel option.
The option is ignored if long-lived graceful restart is disabled by
protocol-wide option. Default: off in aware mode, on in full mode.
<P>
<DT><CODE>
<A NAME="bgp-long-lived-stale-time-c"></A> long lived stale time <I>number</I></CODE><DD><P>Like previous graceful restart channel options, this option allows to
set 
<A HREF="#bgp-long-lived-stale-time">long lived stale time</A>
per AFI/SAFI pair instead of per protocol. Default: set by protocol-wide
option.
</DL>
<P>
<H3><A NAME="bgp-attr"></A> Attributes</H3>

<P>BGP defines several route attributes. Some of them (those marked with
`<CODE>I</CODE>' in the table below) are available on internal BGP connections only,
some of them (marked with `<CODE>O</CODE>') are optional.
<P>
<DL>
<DT><CODE>
<A NAME="rta-bgp-path"></A> bgppath bgp_path</CODE><DD><P>Sequence of AS numbers describing the AS path the packet will travel
through when forwarded according to the particular route. In case of
internal BGP it doesn't contain the number of the local AS.
<P>
<DT><CODE>
<A NAME="rta-bgp-local-pref"></A> int bgp_local_pref [I]</CODE><DD><P>Local preference value used for selection among multiple BGP routes (see
the selection rules above). It's used as an additional metric which is
propagated through the whole local AS.
<P>
<DT><CODE>
<A NAME="rta-bgp-med"></A> int bgp_med [O]</CODE><DD><P>The Multiple Exit Discriminator of the route is an optional attribute
which is used on external (inter-AS) links to convey to an adjacent AS
the optimal entry point into the local AS. The received attribute is
also propagated over internal BGP links. The attribute value is zeroed
when a route is exported to an external BGP instance to ensure that the
attribute received from a neighboring AS is not propagated to other
neighboring ASes. A new value might be set in the export filter of an
external BGP instance. See <A HREF="http://www.rfc-editor.org/info/rfc4451">RFC 4451</A> for further discussion of
BGP MED attribute.
<P>
<DT><CODE>
<A NAME="rta-bgp-origin"></A> enum bgp_origin</CODE><DD><P>Origin of the route: either <CODE>ORIGIN_IGP</CODE> if the route has originated
in an interior routing protocol or <CODE>ORIGIN_EGP</CODE> if it's been imported
from the <CODE>EGP</CODE> protocol (nowadays it seems to be obsolete) or
<CODE>ORIGIN_INCOMPLETE</CODE> if the origin is unknown.
<P>
<DT><CODE>
<A NAME="rta-bgp-next-hop"></A> ip bgp_next_hop</CODE><DD><P>Next hop to be used for forwarding of packets to this destination. On
internal BGP connections, it's an address of the originating router if
it's inside the local AS or a boundary router the packet will leave the
AS through if it's an exterior route, so each BGP speaker within the AS
has a chance to use the shortest interior path possible to this point.
<P>
<DT><CODE>
<A NAME="rta-bgp-atomic-aggr"></A> void bgp_atomic_aggr [O]</CODE><DD><P>This is an optional attribute which carries no value, but the sole
presence of which indicates that the route has been aggregated from
multiple routes by some router on the path from the originator.
<P>
<DT><CODE>
<A NAME="rta-bgp-aggregator"></A> void bgp_aggregator [O]</CODE><DD><P>This is an optional attribute specifying AS number and IP address of the
BGP router that created the route by aggregating multiple BGP routes.
Currently, the attribute is not accessible from filters.
<P>
<DT><CODE>
<A NAME="rta-bgp-community"></A> clist bgp_community [O]</CODE><DD><P>List of community values associated with the route. Each such value is a
pair (represented as a <CODE>pair</CODE> data type inside the filters) of 16-bit
integers, the first of them containing the number of the AS which
defines the community and the second one being a per-AS identifier.
There are lots of uses of the community mechanism, but generally they
are used to carry policy information like "don't export to USA peers".
As each AS can define its own routing policy, it also has a complete
freedom about which community attributes it defines and what will their
semantics be.
<P>
<DT><CODE>
<A NAME="rta-bgp-ext-community"></A> eclist bgp_ext_community [O]</CODE><DD><P>List of extended community values associated with the route. Extended
communities have similar usage as plain communities, but they have an
extended range (to allow 4B ASNs) and a nontrivial structure with a type
field. Individual community values are represented using an <CODE>ec</CODE> data
type inside the filters.
<P>
<DT><CODE>
<A NAME="rta-bgp-large-community"></A> lclist bgp_large_community [O]</CODE><DD><P>List of large community values associated with the route. Large BGP
communities is another variant of communities, but contrary to extended
communities they behave very much the same way as regular communities,
just larger -- they are uniform untyped triplets of 32bit numbers.
Individual community values are represented using an <CODE>lc</CODE> data type
inside the filters.
<P>
<DT><CODE>
<A NAME="rta-bgp-originator-id"></A> quad bgp_originator_id [I, O]</CODE><DD><P>This attribute is created by the route reflector when reflecting the
route and contains the router ID of the originator of the route in the
local AS.
<P>
<DT><CODE>
<A NAME="rta-bgp-cluster-list"></A> clist bgp_cluster_list [I, O]</CODE><DD><P>This attribute contains a list of cluster IDs of route reflectors. Each
route reflector prepends its cluster ID when reflecting the route.
<P>
<DT><CODE>
<A NAME="rta-bgp-aigp"></A> void bgp_aigp [O]</CODE><DD><P>This attribute contains accumulated IGP metric, which is a total
distance to the destination through multiple autonomous systems.
Currently, the attribute is not accessible from filters.
</DL>
<P>
<H3><A NAME="bgp-exam"></A> Example</H3>

<P>
<HR>
<PRE>
protocol bgp {
        local 198.51.100.14 as 65000;        # Use a private AS number
        neighbor 198.51.100.130 as 64496;    # Our neighbor ...
        multihop;                            # ... which is connected indirectly
        ipv4 {
                export filter {                      # We use non-trivial export rules
                        if source = RTS_STATIC then { # Export only static routes
                                # Assign our community
                                bgp_community.add((65000,64501));
                                # Artificially increase path length
                                # by advertising local AS number twice
                                if bgp_path ~ [= 65000 =] then
                                        bgp_path.prepend(65000);
                                accept;
                        }
                        reject;
                };
                import all;
                next hop self; # advertise this router as next hop
                igp table myigptable4; # IGP table for routes with IPv4 nexthops
                igp table myigptable6; # IGP table for routes with IPv6 nexthops
        };
        ipv6 {
                export filter mylargefilter; # We use a named filter
                import all;
                missing lladdr self;
                igp table myigptable4; # IGP table for routes with IPv4 nexthops
                igp table myigptable6; # IGP table for routes with IPv6 nexthops
        };
        ipv4 multicast {
                import all;
                export filter someotherfilter;
                table mymulticasttable4; # Another IPv4 table, dedicated for multicast
                igp table myigptable4;
        };
}
</PRE>
<HR>
<P>
<P>
<H2><A NAME="device"></A> <A NAME="ss6.4">6.4</A> <A HREF="bird.html#toc6.4">Device</A>
</H2>

<P>The Device protocol is not a real routing protocol. It doesn't generate any
routes and it only serves as a module for getting information about network
interfaces from the kernel. This protocol supports no channel.
<P>
<P>Except for very unusual circumstances, you probably should include this
protocol in the configuration since almost all other protocols require network
interfaces to be defined for them to work with.
<P>
<H3><A NAME="device-config"></A> Configuration</H3>

<P>
<DL>
<DT><CODE>
<A NAME="device-scan-time"></A> scan time <I>number</I></CODE><DD><P>Time in seconds between two scans of the network interface list. On
systems where we are notified about interface status changes
asynchronously (such as newer versions of Linux), we need to scan the
list only in order to avoid confusion by lost notification messages,
so the default time is set to a large value.
<P>
<DT><CODE>
<A NAME="device-iface"></A> interface <I>pattern</I> [, <I>...</I>]</CODE><DD><P>By default, the Device protocol handles all interfaces without any
configuration. Interface definitions allow to specify optional
parameters for specific interfaces. See 
<A HREF="bird-3.html#proto-iface">interface</A> common option for detailed description. Currently only
one interface option is available:
<P>
<DT><CODE>
<A NAME="device-preferred"></A> preferred <I>ip</I></CODE><DD><P>If a network interface has more than one IP address, BIRD chooses one of
them as a preferred one. Preferred IP address is used as source address
for packets or announced next hop by routing protocols. Precisely, BIRD
chooses one preferred IPv4 address, one preferred IPv6 address and one
preferred link-local IPv6 address. By default, BIRD chooses the first
found IP address as the preferred one.
<P>This option allows to specify which IP address should be preferred. May
be used multiple times for different address classes (IPv4, IPv6, IPv6
link-local). In all cases, an address marked by operating system as
secondary cannot be chosen as the primary one.
</DL>
<P>
<P>As the Device protocol doesn't generate any routes, it cannot have
any attributes. Example configuration looks like this:
<P>
<P>
<HR>
<PRE>
protocol device {
        scan time 10;           # Scan the interfaces often
        interface "eth0" {
                preferred 192.168.1.1;
                preferred 2001:db8:1:10::1;
        };
}
</PRE>
<HR>
<P>
<P>
<H2><A NAME="direct"></A> <A NAME="ss6.5">6.5</A> <A HREF="bird.html#toc6.5">Direct</A>
</H2>

<P>The Direct protocol is a simple generator of device routes for all the
directly connected networks according to the list of interfaces provided by the
kernel via the Device protocol. The Direct protocol supports both IPv4 and IPv6
channels; both can be configured simultaneously. It can also be configured with
<A HREF="bird-2.html#ip-sadr-routes">IPv6 SADR</A> channel instead of regular IPv6
channel in order to be used together with SADR-enabled Babel protocol.
<P>
<P>The question is whether it is a good idea to have such device routes in BIRD
routing table. OS kernel usually handles device routes for directly connected
networks by itself so we don't need (and don't want) to export these routes to
the kernel protocol. OSPF protocol creates device routes for its interfaces
itself and BGP protocol is usually used for exporting aggregate routes. But the
Direct protocol is necessary for distance-vector protocols like RIP or Babel to
announce local networks.
<P>
<P>There are just few configuration options for the Direct protocol:
<P>
<P>
<DL>
<DT><CODE>
<A NAME="direct-iface"></A> interface <I>pattern</I> [, <I>...</I>]</CODE><DD><P>By default, the Direct protocol will generate device routes for all the
interfaces available. If you want to restrict it to some subset of
interfaces or addresses (e.g. if you're using multiple routing tables
for policy routing and some of the policy domains don't contain all
interfaces), just use this clause. See 
<A HREF="bird-3.html#proto-iface">interface</A>
common option for detailed description. The Direct protocol uses
extended interface clauses.
<P>
<DT><CODE>
<A NAME="direct-check-link"></A> check link <I>switch</I></CODE><DD><P>If enabled, a hardware link state (reported by OS) is taken into
consideration. Routes for directly connected networks are generated only
if link up is reported and they are withdrawn when link disappears
(e.g., an ethernet cable is unplugged). Default value is no.
</DL>
<P>
<P>Direct device routes don't contain any specific attributes.
<P>
<P>Example config might look like this:
<P>
<P>
<HR>
<PRE>
protocol direct {
        ipv4;
        ipv6;
        interface "-arc*", "*";         # Exclude the ARCnets
}
</PRE>
<HR>
<P>
<P>
<H2><A NAME="krt"></A> <A NAME="ss6.6">6.6</A> <A HREF="bird.html#toc6.6">Kernel</A>
</H2>

<P>The Kernel protocol is not a real routing protocol. Instead of communicating
with other routers in the network, it performs synchronization of BIRD's routing
tables with the OS kernel. Basically, it sends all routing table updates to the
kernel and from time to time it scans the kernel tables to see whether some
routes have disappeared (for example due to unnoticed up/down transition of an
interface) or whether an `alien' route has been added by someone else (depending
on the <CODE>learn</CODE> switch, such routes are either ignored or accepted to our
table).
<P>
<P>Note that routes created by OS kernel itself, namely direct routes
representing IP subnets of associated interfaces, are not imported even with
<CODE>learn</CODE> enabled. You can use 
<A HREF="#direct">Direct protocol</A> to
generate these direct routes.
<P>
<P>If your OS supports only a single routing table, you can configure only one
instance of the Kernel protocol. If it supports multiple tables (in order to
allow policy routing; such an OS is for example Linux), you can run as many
instances as you want, but each of them must be connected to a different BIRD
routing table and to a different kernel table.
<P>
<P>Because the kernel protocol is partially integrated with the connected
routing table, there are two limitations - it is not possible to connect more
kernel protocols to the same routing table and changing route destination
(gateway) in an export filter of a kernel protocol does not work. Both
limitations can be overcome using another routing table and the pipe protocol.
<P>
<P>The Kernel protocol supports both IPv4 and IPv6 channels; only one channel
can be configured in each protocol instance. On Linux, it also supports 
<A HREF="bird-2.html#ip-sadr-routes">IPv6 SADR</A> and 
<A HREF="bird-2.html#mpls-routes">MPLS</A>
channels.
<P>
<H3><A NAME="krt-config"></A> Configuration</H3>

<P>
<DL>
<DT><CODE>
<A NAME="krt-persist"></A> persist <I>switch</I></CODE><DD><P>Tell BIRD to leave all its routes in the routing tables when it exits
(instead of cleaning them up).
<P>
<DT><CODE>
<A NAME="krt-scan-time"></A> scan time <I>number</I></CODE><DD><P>Time in seconds between two consecutive scans of the kernel routing
table.
<P>
<DT><CODE>
<A NAME="krt-learn"></A> learn <I>switch</I></CODE><DD><P>Enable learning of routes added to the kernel routing tables by other
routing daemons or by the system administrator. This is possible only on
systems which support identification of route authorship.
<P>
<DT><CODE>
<A NAME="krt-kernel-table"></A> kernel table <I>number</I></CODE><DD><P>Select which kernel table should this particular instance of the Kernel
protocol work with. Available only on systems supporting multiple
routing tables.
<P>
<DT><CODE>
<A NAME="krt-metric"></A> metric <I>number</I></CODE><DD><P>(Linux)
Use specified value as a kernel metric (priority) for all routes sent to
the kernel. When multiple routes for the same network are in the kernel
routing table, the Linux kernel chooses one with lower metric. Also,
routes with different metrics do not clash with each other, therefore
using dedicated metric value is a reliable way to avoid overwriting
routes from other sources (e.g. kernel device routes). Metric 0 has a
special meaning of undefined metric, in which either OS default is used,
or per-route metric can be set using <CODE>krt_metric</CODE> attribute. Default:
32.
<P>
<DT><CODE>
<A NAME="krt-graceful-restart"></A> graceful restart <I>switch</I></CODE><DD><P>Participate in graceful restart recovery. If this option is enabled and
a graceful restart recovery is active, the Kernel protocol will defer
synchronization of routing tables until the end of the recovery. Note
that import of kernel routes to BIRD is not affected.
<P>
<DT><CODE>
<A NAME="krt-merge-paths"></A> merge paths <I>switch</I> [limit <I>number</I>]</CODE><DD><P>Usually, only best routes are exported to the kernel protocol. With path
merging enabled, both best routes and equivalent non-best routes are
merged during export to generate one ECMP (equal-cost multipath) route
for each network. This is useful e.g. for BGP multipath. Note that best
routes are still pivotal for route export (responsible for most
properties of resulting ECMP routes), while exported non-best routes are
responsible just for additional multipath next hops. This option also
allows to specify a limit on maximal number of nexthops in one route. By
default, multipath merging is disabled. If enabled, default value of the
limit is 16.
</DL>
<P>
<H3><A NAME="krt-attr"></A> Attributes</H3>

<P>The Kernel protocol defines several attributes. These attributes are
translated to appropriate system (and OS-specific) route attributes. We support
these attributes:
<P>
<DL>
<DT><CODE>
<A NAME="rta-krt-source"></A> int krt_source</CODE><DD><P>The original source of the imported kernel route. The value is
system-dependent. On Linux, it is a value of the protocol field of the
route. See /etc/iproute2/rt_protos for common values. On BSD, it is
based on STATIC and PROTOx flags. The attribute is read-only.
<P>
<DT><CODE>
<A NAME="rta-krt-metric"></A> int krt_metric</CODE><DD><P>(Linux)
The kernel metric of the route. When multiple same routes are in a
kernel routing table, the Linux kernel chooses one with lower metric.
Note that preferred way to set kernel metric is to use protocol option
<CODE>metric</CODE>, unless per-route metric values are needed.
<P>
<DT><CODE>
<A NAME="rta-krt-prefsrc"></A> ip krt_prefsrc</CODE><DD><P>(Linux)
The preferred source address. Used in source address selection for
outgoing packets. Has to be one of the IP addresses of the router.
<P>
<DT><CODE>
<A NAME="rta-krt-realm"></A> int krt_realm</CODE><DD><P>(Linux)
The realm of the route. Can be used for traffic classification.
<P>
<DT><CODE>
<A NAME="rta-krt-scope"></A> int krt_scope</CODE><DD><P>(Linux IPv4)
The scope of the route. Valid values are 0-254, although Linux kernel
may reject some values depending on route type and nexthop. It is
supposed to represent `indirectness' of the route, where nexthops of
routes are resolved through routes with a higher scope, but in current
kernels anything below <I>link</I> (253) is treated as <I>global</I> (0).
When not present, global scope is implied for all routes except device
routes, where link scope is used by default.
</DL>
<P>
<P>In Linux, there is also a plenty of obscure route attributes mostly focused
on tuning TCP performance of local connections. BIRD supports most of these
attributes, see Linux or iproute2 documentation for their meaning. Attributes
<CODE>krt_lock_*</CODE> and <CODE>krt_feature_*</CODE> have type bool, others have type int.
Supported attributes are:
<P><CODE>krt_mtu</CODE>, <CODE>krt_lock_mtu</CODE>, <CODE>krt_window</CODE>, <CODE>krt_lock_window</CODE>,
<CODE>krt_rtt</CODE>, <CODE>krt_lock_rtt</CODE>, <CODE>krt_rttvar</CODE>, <CODE>krt_lock_rttvar</CODE>,
<CODE>krt_sstresh</CODE>, <CODE>krt_lock_sstresh</CODE>, <CODE>krt_cwnd</CODE>, <CODE>krt_lock_cwnd</CODE>,
<CODE>krt_advmss</CODE>, <CODE>krt_lock_advmss</CODE>, <CODE>krt_reordering</CODE>, <CODE>krt_lock_reordering</CODE>,
<CODE>krt_hoplimit</CODE>, <CODE>krt_lock_hoplimit</CODE>, <CODE>krt_rto_min</CODE>, <CODE>krt_lock_rto_min</CODE>,
<CODE>krt_initcwnd</CODE>, <CODE>krt_initrwnd</CODE>, <CODE>krt_quickack</CODE>,
<CODE>krt_feature_ecn</CODE>, <CODE>krt_feature_allfrag</CODE>
<P>
<H3><A NAME="krt-exam"></A> Example</H3>

<P>A simple configuration can look this way:
<P>
<P>
<HR>
<PRE>
protocol kernel {
        export all;
}
</PRE>
<HR>
<P>
<P>Or for a system with two routing tables:
<P>
<P>
<HR>
<PRE>
protocol kernel {               # Primary routing table
        learn;                  # Learn alien routes from the kernel
        persist;                # Don't remove routes on bird shutdown
        scan time 10;           # Scan kernel routing table every 10 seconds
        ipv4 {
                import all;
                export all;
        };
}

protocol kernel {               # Secondary routing table
        kernel table 100;
        ipv4 {
                table auxtable;
                export all;
        };
}
</PRE>
<HR>
<P>
<P>
<H2><A NAME="mrt"></A> <A NAME="ss6.7">6.7</A> <A HREF="bird.html#toc6.7">MRT</A>
</H2>

<H3><A NAME="mrt-intro"></A> Introduction</H3>

<P>The MRT protocol is a component responsible for handling the Multi-Threaded
Routing Toolkit (MRT) routing information export format, which is mainly used
for collecting and analyzing of routing information from BGP routers. The MRT
protocol can be configured to do periodic dumps of routing tables, created MRT
files can be analyzed later by other tools. Independent MRT table dumps can also
be requested from BIRD client. There is also a feature to save incoming BGP
messages in MRT files, but it is controlled by 
<A HREF="bird-3.html#proto-mrtdump">mrtdump</A> options independently of MRT protocol, although that might
change in the future.
<P>BIRD implements the main MRT format specification as defined in <A HREF="http://www.rfc-editor.org/info/rfc6396">RFC 6396</A>
and the ADD_PATH extension (<A HREF="http://www.rfc-editor.org/info/rfc8050">RFC 8050</A>).
<P>
<H3><A NAME="mrt-config"></A> Configuration</H3>

<P>MRT configuration consists of several statements describing routing table
dumps. Multiple independent periodic dumps can be done as multiple MRT protocol
instances. The MRT protocol does not use channels. There are two mandatory
statements: <CODE>filename</CODE> and <CODE>period</CODE>.
<P>The behavior can be modified by following configuration parameters:
<P>
<DL>
<DT><CODE>
<A NAME="mrt-table"></A> table <I>name</I> | "<I>pattern</I>"</CODE><DD><P>Specify a routing table (or a set of routing tables described by a
wildcard pattern) that are to be dumped by the MRT protocol instance.
Default: the master table.
<P>
<DT><CODE>
<A NAME="mrt-filter"></A> filter { <I>filter commands</I> }</CODE><DD><P>The MRT protocol allows to specify a filter that is applied to routes as
they are dumped. Rejected routes are ignored and not saved to the MRT
dump file. Default: no filter.
<P>
<DT><CODE>
<A NAME="mrt-where"></A> where <I>filter expression</I></CODE><DD><P>An alternative way to specify a filter for the MRT protocol.
<P>
<DT><CODE>
<A NAME="mrt-filename"></A> filename "<I>filename</I>"</CODE><DD><P>Specify a filename for MRT dump files. The filename may contain time
format sequences with <I>strftime(3)</I> notation (see <I>man strftime</I>
for details), there is also a sequence "%N" that is expanded to the name
of dumped table. Therefore, each periodic dump of each table can be
saved to a different file. Mandatory, see example below.
<P>
<DT><CODE>
<A NAME="mrt-period"></A> period <I>number</I></CODE><DD><P>Specify the time interval (in seconds) between periodic dumps.
Mandatory.
<P>
<DT><CODE>
<A NAME="mrt-always-add-path"></A> always add path <I>switch</I></CODE><DD><P>The MRT format uses special records (specified in <A HREF="http://www.rfc-editor.org/info/rfc8050">RFC 8050</A>) for
routes received using BGP ADD_PATH extension to keep Path ID, while
other routes use regular records. This has advantage of better
compatibility with tools that do not know special records, but it loses
information about which route is the best route. When this option is
enabled, both ADD_PATH and non-ADD_PATH routes are stored in ADD_PATH
records and order of routes for network is preserved. Default: disabled.
</DL>
<P>
<H3><A NAME="mrt-exam"></A> Example</H3>

<P>
<HR>
<PRE>
protocol mrt {
        table "tab*";
        where source = RTS_BGP;
        filename "/var/log/bird/%N_%F_%T.mrt";
        period 300;
}
</PRE>
<HR>
<P>
<P>
<H2><A NAME="ospf"></A> <A NAME="ss6.8">6.8</A> <A HREF="bird.html#toc6.8">OSPF</A>
</H2>

<H3><A NAME="ospf-intro"></A> Introduction</H3>

<P>Open Shortest Path First (OSPF) is a quite complex interior gateway
protocol. The current IPv4 version (OSPFv2) is defined in <A HREF="http://www.rfc-editor.org/info/rfc2328">RFC 2328</A> and
the current IPv6 version (OSPFv3) is defined in <A HREF="http://www.rfc-editor.org/info/rfc5340">RFC 5340</A> It's a link
state (a.k.a. shortest path first) protocol -- each router maintains a database
describing the autonomous system's topology. Each participating router has an
identical copy of the database and all routers run the same algorithm
calculating a shortest path tree with themselves as a root. OSPF chooses the
least cost path as the best path.
<P>
<P>In OSPF, the autonomous system can be split to several areas in order to
reduce the amount of resources consumed for exchanging the routing information
and to protect the other areas from incorrect routing data. Topology of the area
is hidden to the rest of the autonomous system.
<P>
<P>Another very important feature of OSPF is that it can keep routing information
from other protocols (like Static or BGP) in its link state database as external
routes. Each external route can be tagged by the advertising router, making it
possible to pass additional information between routers on the boundary of the
autonomous system.
<P>
<P>OSPF quickly detects topological changes in the autonomous system (such as
router interface failures) and calculates new loop-free routes after a short
period of convergence. Only a minimal amount of routing traffic is involved.
<P>
<P>Each router participating in OSPF routing periodically sends Hello messages
to all its interfaces. This allows neighbors to be discovered dynamically. Then
the neighbors exchange theirs parts of the link state database and keep it
identical by flooding updates. The flooding process is reliable and ensures that
each router detects all changes.
<P>
<H3><A NAME="ospf-config"></A> Configuration</H3>

<P>First, the desired OSPF version can be specified by using <CODE>ospf v2</CODE> or
<CODE>ospf v3</CODE> as a protocol type. By default, OSPFv2 is used. In the main part of
configuration, there can be multiple definitions of OSPF areas, each with a
different id. These definitions includes many other switches and multiple
definitions of interfaces. Definition of interface may contain many switches and
constant definitions and list of neighbors on nonbroadcast networks.
<P>
<P>OSPFv2 needs one IPv4 channel. OSPFv3 needs either one IPv6 channel, or one
IPv4 channel (<A HREF="http://www.rfc-editor.org/info/rfc5838">RFC 5838</A>). Therefore, it is possible to use OSPFv3 for both
IPv4 and Pv6 routing, but it is necessary to have two protocol instances anyway.
If no channel is configured, appropriate channel is defined with default
parameters.
<P>
<HR>
<PRE>
protocol ospf [v2|v3] &lt;name&gt; {
        rfc1583compat &lt;switch&gt;;
        rfc5838 &lt;switch&gt;;
        instance id &lt;num&gt;;
        stub router &lt;switch&gt;;
        tick &lt;num&gt;;
        ecmp &lt;switch&gt; [limit &lt;num&gt;];
        merge external &lt;switch&gt;;
        graceful restart &lt;switch&gt;|aware;
        graceful restart time &lt;num&gt;;
        area &lt;id&gt; {
                stub;
                nssa;
                summary &lt;switch&gt;;
                default nssa &lt;switch&gt;;
                default cost &lt;num&gt;;
                default cost2 &lt;num&gt;;
                translator &lt;switch&gt;;
                translator stability &lt;num&gt;;

                networks {
                        &lt;prefix&gt;;
                        &lt;prefix&gt; hidden;
                }
                external {
                        &lt;prefix&gt;;
                        &lt;prefix&gt; hidden;
                        &lt;prefix&gt; tag &lt;num&gt;;
                }
                stubnet &lt;prefix&gt;;
                stubnet &lt;prefix&gt; {
                        hidden &lt;switch&gt;;
                        summary &lt;switch&gt;;
                        cost &lt;num&gt;;
                }
                interface &lt;interface pattern&gt; [instance &lt;num&gt;] {
                        cost &lt;num&gt;;
                        stub &lt;switch&gt;;
                        hello &lt;num&gt;;
                        poll &lt;num&gt;;
                        retransmit &lt;num&gt;;
                        priority &lt;num&gt;;
                        wait &lt;num&gt;;
                        dead count &lt;num&gt;;
                        dead &lt;num&gt;;
                        secondary &lt;switch&gt;;
                        rx buffer [normal|large|&lt;num&gt;];
                        tx length &lt;num&gt;;
                        type [broadcast|bcast|pointopoint|ptp|
                                nonbroadcast|nbma|pointomultipoint|ptmp];
                        link lsa suppression &lt;switch&gt;;
                        strict nonbroadcast &lt;switch&gt;;
                        real broadcast &lt;switch&gt;;
                        ptp netmask &lt;switch&gt;;
                        check link &lt;switch&gt;;
                        bfd &lt;switch&gt;;
                        ecmp weight &lt;num&gt;;
                        ttl security [&lt;switch&gt;; | tx only]
                        tx class|dscp &lt;num&gt;;
                        tx priority &lt;num&gt;;
                        authentication none|simple|cryptographic;
                        password "&lt;text&gt;";
                        password "&lt;text&gt;" {
                                id &lt;num&gt;;
                                generate from "&lt;date&gt;";
                                generate to "&lt;date&gt;";
                                accept from "&lt;date&gt;";
                                accept to "&lt;date&gt;";
                                from "&lt;date&gt;";
                                to "&lt;date&gt;";
                                algorithm ( keyed md5 | keyed sha1 | hmac sha1 | hmac sha256 | hmac sha384 | hmac sha512 );
                        };
                        neighbors {
                                &lt;ip&gt;;
                                &lt;ip&gt; eligible;
                        };
                };
                virtual link &lt;id&gt; [instance &lt;num&gt;] {
                        hello &lt;num&gt;;
                        retransmit &lt;num&gt;;
                        wait &lt;num&gt;;
                        dead count &lt;num&gt;;
                        dead &lt;num&gt;;
                        authentication none|simple|cryptographic;
                        password "&lt;text&gt;";
                        password "&lt;text&gt;" {
                                id &lt;num&gt;;
                                generate from "&lt;date&gt;";
                                generate to "&lt;date&gt;";
                                accept from "&lt;date&gt;";
                                accept to "&lt;date&gt;";
                                from "&lt;date&gt;";
                                to "&lt;date&gt;";
                                algorithm ( keyed md5 | keyed sha1 | hmac sha1 | hmac sha256 | hmac sha384 | hmac sha512 );
                        };
                };
        };
}
</PRE>
<HR>
<P>
<DL>
<DT><CODE>
<A NAME="ospf-rfc1583compat"></A> rfc1583compat <I>switch</I></CODE><DD><P>This option controls compatibility of routing table calculation with
<A HREF="http://www.rfc-editor.org/info/rfc1583">RFC 1583</A>. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-rfc5838"></A> rfc5838 <I>switch</I></CODE><DD><P>Basic OSPFv3 is limited to IPv6 unicast routing. The <A HREF="http://www.rfc-editor.org/info/rfc5838">RFC 5838</A>
extension defines support for more address families (IPv4, IPv6, both
unicast and multicast). The extension is enabled by default, but can be
disabled if necessary, as it restricts the range of available instance
IDs. Default value is yes.
<P>
<DT><CODE>
<A NAME="ospf-instance-id"></A> instance id <I>num</I></CODE><DD><P>When multiple OSPF protocol instances are active on the same links, they
should use different instance IDs to distinguish their packets. Although
it could be done on per-interface basis, it is often preferred to set
one instance ID to whole OSPF domain/topology (e.g., when multiple
instances are used to represent separate logical topologies on the same
physical network). This option specifies the instance ID for all
interfaces of the OSPF instance, but can be overridden by
<CODE>interface</CODE> option. Default value is 0 unless OSPFv3-AF extended
address families are used, see <A HREF="http://www.rfc-editor.org/info/rfc5838">RFC 5838</A> for that case.
<P>
<DT><CODE>
<A NAME="ospf-stub-router"></A> stub router <I>switch</I></CODE><DD><P>This option configures the router to be a stub router, i.e., a router
that participates in the OSPF topology but does not allow transit
traffic. In OSPFv2, this is implemented by advertising maximum metric
for outgoing links. In OSPFv3, the stub router behavior is announced by
clearing the R-bit in the router LSA. See <A HREF="http://www.rfc-editor.org/info/rfc6987">RFC 6987</A> for details.
Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-tick"></A> tick <I>num</I></CODE><DD><P>The routing table calculation and clean-up of areas' databases is not
performed when a single link state change arrives. To lower the CPU
utilization, it's processed later at periodical intervals of <I>num</I>
seconds. The default value is 1.
<P>
<DT><CODE>
<A NAME="ospf-ecmp"></A> ecmp <I>switch</I> [limit <I>number</I>]</CODE><DD><P>This option specifies whether OSPF is allowed to generate ECMP
(equal-cost multipath) routes. Such routes are used when there are
several directions to the destination, each with the same (computed)
cost. This option also allows to specify a limit on maximum number of
nexthops in one route. By default, ECMP is enabled if supported by
Kernel. Default value of the limit is 16.
<P>
<DT><CODE>
<A NAME="ospf-merge-external"></A> merge external <I>switch</I></CODE><DD><P>This option specifies whether OSPF should merge external routes from
different routers/LSAs for the same destination. When enabled together
with <CODE>ecmp</CODE>, equal-cost external routes will be combined to multipath
routes in the same way as regular routes. When disabled, external routes
from different LSAs are treated as separate even if they represents the
same destination. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-graceful-restart"></A> graceful restart <I>switch</I>|aware</CODE><DD><P>When an OSPF instance is restarted, neighbors break adjacencies and
recalculate their routing tables, which disrupts packet forwarding even
when the forwarding plane of the restarting router remains intact.
<A HREF="http://www.rfc-editor.org/info/rfc3623">RFC 3623</A> specifies a graceful restart mechanism to alleviate this
issue. For OSPF graceful restart, restarting router originates
Grace-LSAs, announcing intent to do graceful restart. Neighbors
receiving these LSAs enter helper mode, in which they ignore breakdown
of adjacencies, behave as if nothing is happening and keep old routes.
When adjacencies are reestablished, the restarting router flushes
Grace-LSAs and graceful restart is ended.
<P>This option controls the graceful restart mechanism. It has three
states: Disabled, when no support is provided. Aware, when graceful
restart helper mode is supported, but no local graceful restart is
allowed (i.e. helper-only role). Enabled, when the full graceful restart
support is provided (i.e. both restarting and helper role). Note that
proper support for local graceful restart requires also configuration of
other protocols. Default: aware.
<P>
<DT><CODE>
<A NAME="ospf-graceful-restart-time"></A> graceful restart time <I>num</I></CODE><DD><P>The restart time is announced in the Grace-LSA and specifies how long
neighbors should wait for proper end of the graceful restart before
exiting helper mode prematurely. Default: 120 seconds.
<P>
<DT><CODE>
<A NAME="ospf-area"></A> area <I>id</I></CODE><DD><P>This defines an OSPF area with given area ID (an integer or an IPv4
address, similarly to a router ID). The most important area is the
backbone (ID 0) to which every other area must be connected.
<P>
<DT><CODE>
<A NAME="ospf-stub"></A> stub</CODE><DD><P>This option configures the area to be a stub area. External routes are
not flooded into stub areas. Also summary LSAs can be limited in stub
areas (see option <CODE>summary</CODE>). By default, the area is not a stub
area.
<P>
<DT><CODE>
<A NAME="ospf-nssa"></A> nssa</CODE><DD><P>This option configures the area to be a NSSA (Not-So-Stubby Area). NSSA
is a variant of a stub area which allows a limited way of external route
propagation. Global external routes are not propagated into a NSSA, but
an external route can be imported into NSSA as a (area-wide) NSSA-LSA
(and possibly translated and/or aggregated on area boundary). By
default, the area is not NSSA.
<P>
<DT><CODE>
<A NAME="ospf-summary"></A> summary <I>switch</I></CODE><DD><P>This option controls propagation of summary LSAs into stub or NSSA
areas. If enabled, summary LSAs are propagated as usual, otherwise just
the default summary route (0.0.0.0/0) is propagated (this is sometimes
called totally stubby area). If a stub area has more area boundary
routers, propagating summary LSAs could lead to more efficient routing
at the cost of larger link state database. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-default-nssa"></A> default nssa <I>switch</I></CODE><DD><P>When <CODE>summary</CODE> option is enabled, default summary route is no longer
propagated to the NSSA. In that case, this option allows to originate
default route as NSSA-LSA to the NSSA. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-default-cost"></A> default cost <I>num</I></CODE><DD><P>This option controls the cost of a default route propagated to stub and
NSSA areas. Default value is 1000.
<P>
<DT><CODE>
<A NAME="ospf-default-cost2"></A> default cost2 <I>num</I></CODE><DD><P>When a default route is originated as NSSA-LSA, its cost can use either
type 1 or type 2 metric. This option allows to specify the cost of a
default route in type 2 metric. By default, type 1 metric (option
<CODE>default cost</CODE>) is used.
<P>
<DT><CODE>
<A NAME="ospf-translator"></A> translator <I>switch</I></CODE><DD><P>This option controls translation of NSSA-LSAs into external LSAs. By
default, one translator per NSSA is automatically elected from area
boundary routers. If enabled, this area boundary router would
unconditionally translate all NSSA-LSAs regardless of translator
election. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-translator-stability"></A> translator stability <I>num</I></CODE><DD><P>This option controls the translator stability interval (in seconds).
When the new translator is elected, the old one keeps translating until
the interval is over. Default value is 40.
<P>
<DT><CODE>
<A NAME="ospf-networks"></A> networks { <I>set</I> }</CODE><DD><P>Definition of area IP ranges. This is used in summary LSA origination.
Hidden networks are not propagated into other areas.
<P>
<DT><CODE>
<A NAME="ospf-external"></A> external { <I>set</I> }</CODE><DD><P>Definition of external area IP ranges for NSSAs. This is used for
NSSA-LSA translation. Hidden networks are not translated into external
LSAs. Networks can have configured route tag.
<P>
<DT><CODE>
<A NAME="ospf-stubnet"></A> stubnet <I>prefix</I> { <I>options</I> }</CODE><DD><P>Stub networks are networks that are not transit networks between OSPF
routers. They are also propagated through an OSPF area as a part of a
link state database. By default, BIRD generates a stub network record
for each primary network address on each OSPF interface that does not
have any OSPF neighbors, and also for each non-primary network address
on each OSPF interface. This option allows to alter a set of stub
networks propagated by this router.
<P>Each instance of this option adds a stub network with given network
prefix to the set of propagated stub network, unless option <CODE>hidden</CODE>
is used. It also suppresses default stub networks for given network
prefix. When option <CODE>summary</CODE> is used, also default stub networks
that are subnetworks of given stub network are suppressed. This might be
used, for example, to aggregate generated stub networks.
<P>
<DT><CODE>
<A NAME="ospf-iface"></A> interface <I>pattern</I> [instance <I>num</I>]</CODE><DD><P>Defines that the specified interfaces belong to the area being defined.
See 
<A HREF="bird-3.html#proto-iface">interface</A> common option for detailed
description. In OSPFv2, extended interface clauses are used, because
each network prefix is handled as a separate virtual interface.
<P>You can specify alternative instance ID for the interface definition,
therefore it is possible to have several instances of that interface
with different options or even in different areas. For OSPFv2, instance
ID support is an extension (<A HREF="http://www.rfc-editor.org/info/rfc6549">RFC 6549</A>) and is supposed to be set
per-protocol. For OSPFv3, it is an integral feature.
<P>
<DT><CODE>
<A NAME="ospf-virtual-link"></A> virtual link <I>id</I> [instance <I>num</I>]</CODE><DD><P>Virtual link to router with the router id. Virtual link acts as a
point-to-point interface belonging to backbone. The actual area is used
as a transport area. This item cannot be in the backbone. Like with
<CODE>interface</CODE> option, you could also use several virtual links to one
destination with different instance IDs.
<P>
<DT><CODE>
<A NAME="ospf-cost"></A> cost <I>num</I></CODE><DD><P>Specifies output cost (metric) of an interface. Default value is 10.
<P>
<DT><CODE>
<A NAME="ospf-stub-iface"></A> stub <I>switch</I></CODE><DD><P>If set to interface it does not listen to any packet and does not send
any hello. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-hello"></A> hello <I>num</I></CODE><DD><P>Specifies interval in seconds between sending of Hello messages. Beware,
all routers on the same network need to have the same hello interval.
Default value is 10.
<P>
<DT><CODE>
<A NAME="ospf-poll"></A> poll <I>num</I></CODE><DD><P>Specifies interval in seconds between sending of Hello messages for some
neighbors on NBMA network. Default value is 20.
<P>
<DT><CODE>
<A NAME="ospf-retransmit"></A> retransmit <I>num</I></CODE><DD><P>Specifies interval in seconds between retransmissions of unacknowledged
updates. Default value is 5.
<P>
<DT><CODE>
<A NAME="ospf-transmit-delay"></A> transmit delay <I>num</I></CODE><DD><P>Specifies estimated transmission delay of link state updates send over
the interface. The value is added to LSA age of LSAs propagated through
it. Default value is 1.
<P>
<DT><CODE>
<A NAME="ospf-priority"></A> priority <I>num</I></CODE><DD><P>On every multiple access network (e.g., the Ethernet) Designated Router
and Backup Designated router are elected. These routers have some special
functions in the flooding process. Higher priority increases preferences
in this election. Routers with priority 0 are not eligible. Default
value is 1.
<P>
<DT><CODE>
<A NAME="ospf-wait"></A> wait <I>num</I></CODE><DD><P>After start, router waits for the specified number of seconds between
starting election and building adjacency. Default value is 4*<I>hello</I>.
<P>
<DT><CODE>
<A NAME="ospf-dead-count"></A> dead count <I>num</I></CODE><DD><P>When the router does not receive any messages from a neighbor in
<I>dead count</I>*<I>hello</I> seconds, it will consider the neighbor down.
<P>
<DT><CODE>
<A NAME="ospf-dead"></A> dead <I>num</I></CODE><DD><P>When the router does not receive any messages from a neighbor in
<I>dead</I> seconds, it will consider the neighbor down. If both directives
<CODE>dead count</CODE> and <CODE>dead</CODE> are used, <CODE>dead</CODE> has precedence.
<P>
<DT><CODE>
<A NAME="ospf-rx-buffer"></A> rx buffer <I>num</I></CODE><DD><P>This option allows to specify the size of buffers used for packet
processing. The buffer size should be bigger than maximal size of any
packets. By default, buffers are dynamically resized as needed, but a
fixed value could be specified. Value <CODE>large</CODE> means maximal allowed
packet size - 65535.
<P>
<DT><CODE>
<A NAME="ospf-tx-length"></A> tx length <I>num</I></CODE><DD><P>Transmitted OSPF messages that contain large amount of information are
segmented to separate OSPF packets to avoid IP fragmentation. This
option specifies the soft ceiling for the length of generated OSPF
packets. Default value is the MTU of the network interface. Note that
larger OSPF packets may still be generated if underlying OSPF messages
cannot be splitted (e.g. when one large LSA is propagated).
<P>
<DT><CODE>
<A NAME="ospf-type-bcast"></A> type broadcast|bcast</CODE><DD><P>BIRD detects a type of a connected network automatically, but sometimes
it's convenient to force use of a different type manually. On broadcast
networks (like ethernet), flooding and Hello messages are sent using
multicasts (a single packet for all the neighbors). A designated router
is elected and it is responsible for synchronizing the link-state
databases and originating network LSAs. This network type cannot be used
on physically NBMA networks and on unnumbered networks (networks without
proper IP prefix).
<P>
<DT><CODE>
<A NAME="ospf-type-ptp"></A> type pointopoint|ptp</CODE><DD><P>Point-to-point networks connect just 2 routers together. No election is
performed and no network LSA is originated, which makes it simpler and
faster to establish. This network type is useful not only for physically
PtP ifaces (like PPP or tunnels), but also for broadcast networks used
as PtP links. This network type cannot be used on physically NBMA
networks.
<P>
<DT><CODE>
<A NAME="ospf-type-nbma"></A> type nonbroadcast|nbma</CODE><DD><P>On NBMA networks, the packets are sent to each neighbor separately
because of lack of multicast capabilities. Like on broadcast networks,
a designated router is elected, which plays a central role in propagation
of LSAs. This network type cannot be used on unnumbered networks.
<P>
<DT><CODE>
<A NAME="ospf-type-ptmp"></A> type pointomultipoint|ptmp</CODE><DD><P>This is another network type designed to handle NBMA networks. In this
case the NBMA network is treated as a collection of PtP links. This is
useful if not every pair of routers on the NBMA network has direct
communication, or if the NBMA network is used as an (possibly
unnumbered) PtP link.
<P>
<DT><CODE>
<A NAME="ospf-link-lsa-suppression"></A> link lsa suppression <I>switch</I></CODE><DD><P>In OSPFv3, link LSAs are generated for each link, announcing link-local
IPv6 address of the router to its local neighbors. These are useless on
PtP or PtMP networks and this option allows to suppress the link LSA
origination for such interfaces. The option is ignored on other than PtP
or PtMP interfaces. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-strict-nonbroadcast"></A> strict nonbroadcast <I>switch</I></CODE><DD><P>If set, don't send hello to any undefined neighbor. This switch is
ignored on other than NBMA or PtMP interfaces. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-real-broadcast"></A> real broadcast <I>switch</I></CODE><DD><P>In <CODE>type broadcast</CODE> or <CODE>type ptp</CODE> network configuration, OSPF
packets are sent as IP multicast packets. This option changes the
behavior to using old-fashioned IP broadcast packets. This may be useful
as a workaround if IP multicast for some reason does not work or does
not work reliably. This is a non-standard option and probably is not
interoperable with other OSPF implementations. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-ptp-netmask"></A> ptp netmask <I>switch</I></CODE><DD><P>In <CODE>type ptp</CODE> network configurations, OSPFv2 implementations should
ignore received netmask field in hello packets and should send hello
packets with zero netmask field on unnumbered PtP links. But some OSPFv2
implementations perform netmask checking even for PtP links. This option
specifies whether real netmask will be used in hello packets on <CODE>type
ptp</CODE> interfaces. You should ignore this option unless you meet some
compatibility problems related to this issue. Default value is no for
unnumbered PtP links, yes otherwise.
<P>
<DT><CODE>
<A NAME="ospf-check-link"></A> check link <I>switch</I></CODE><DD><P>If set, a hardware link state (reported by OS) is taken into consideration.
When a link disappears (e.g. an ethernet cable is unplugged), neighbors
are immediately considered unreachable and only the address of the iface
(instead of whole network prefix) is propagated. It is possible that
some hardware drivers or platforms do not implement this feature.
Default value is yes.
<P>
<DT><CODE>
<A NAME="ospf-bfd"></A> bfd <I>switch</I></CODE><DD><P>OSPF could use BFD protocol as an advisory mechanism for neighbor
liveness and failure detection. If enabled, BIRD setups a BFD session
for each OSPF neighbor and tracks its liveness by it. This has an
advantage of an order of magnitude lower detection times in case of
failure. Note that BFD protocol also has to be configured, see
<A HREF="#bfd">BFD</A> section for details. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-ttl-security"></A> ttl security [<I>switch</I> | tx only]</CODE><DD><P>TTL security is a feature that protects routing protocols from remote
spoofed packets by using TTL 255 instead of TTL 1 for protocol packets
destined to neighbors. Because TTL is decremented when packets are
forwarded, it is non-trivial to spoof packets with TTL 255 from remote
locations. Note that this option would interfere with OSPF virtual
links.
<P>If this option is enabled, the router will send OSPF packets with TTL
255 and drop received packets with TTL less than 255. If this option si
set to <CODE>tx only</CODE>, TTL 255 is used for sent packets, but is not
checked for received packets. Default value is no.
<P>
<DT><CODE>
<A NAME="ospf-tx-class"></A> tx class|dscp|priority <I>num</I></CODE><DD><P>These options specify the ToS/DiffServ/Traffic class/Priority of the
outgoing OSPF packets. See 
<A HREF="bird-3.html#proto-tx-class">tx class</A> common
option for detailed description.
<P>
<DT><CODE>
<A NAME="ospf-ecmp-weight"></A> ecmp weight <I>num</I></CODE><DD><P>When ECMP (multipath) routes are allowed, this value specifies a
relative weight used for nexthops going through the iface. Allowed
values are 1-256. Default value is 1.
<P>
<DT><CODE>
<A NAME="ospf-auth-none"></A> authentication none</CODE><DD><P>No passwords are sent in OSPF packets. This is the default value.
<P>
<DT><CODE>
<A NAME="ospf-auth-simple"></A> authentication simple</CODE><DD><P>Every packet carries 8 bytes of password. Received packets lacking this
password are ignored. This authentication mechanism is very weak.
This option is not available in OSPFv3.
<P>
<DT><CODE>
<A NAME="ospf-auth-cryptographic"></A> authentication cryptographic</CODE><DD><P>An authentication code is appended to every packet. The specific
cryptographic algorithm is selected by option <CODE>algorithm</CODE> for each
key. The default cryptographic algorithm for OSPFv2 keys is Keyed-MD5
and for OSPFv3 keys is HMAC-SHA-256. Passwords are not sent open via
network, so this mechanism is quite secure. Packets can still be read by
an attacker.
<P>
<DT><CODE>
<A NAME="ospf-pass"></A> password "<I>text</I>"</CODE><DD><P>Specifies a password used for authentication. See
<A HREF="bird-3.html#proto-pass">password</A> common option for detailed
description.
<P>
<DT><CODE>
<A NAME="ospf-neighbors"></A> neighbors { <I>set</I> } </CODE><DD><P>A set of neighbors to which Hello messages on NBMA or PtMP networks are
to be sent. For NBMA networks, some of them could be marked as eligible.
In OSPFv3, link-local addresses should be used, using global ones is
possible, but it is nonstandard and might be problematic. And definitely,
link-local and global addresses should not be mixed.
</DL>
<P>
<H3><A NAME="ospf-attr"></A> Attributes</H3>

<P>OSPF defines four route attributes. Each internal route has a <CODE>metric</CODE>.
<P>
<P>Metric is ranging from 1 to infinity (65535). External routes use
<CODE>metric type 1</CODE> or <CODE>metric type 2</CODE>. A <CODE>metric of type 1</CODE> is comparable
with internal <CODE>metric</CODE>, a <CODE>metric of type 2</CODE> is always longer than any
<CODE>metric of type 1</CODE> or any <CODE>internal metric</CODE>. <CODE>Internal metric</CODE> or
<CODE>metric of type 1</CODE> is stored in attribute <CODE>ospf_metric1</CODE>, <CODE>metric type
2</CODE> is stored in attribute <CODE>ospf_metric2</CODE>.
<P>When both metrics are specified then <CODE>metric of type 2</CODE> is used. This is
relevant e.g. when a type 2 external route is propagated from one OSPF domain to
another and <CODE>ospf_metric1</CODE> is an internal distance to the original ASBR,
while <CODE>ospf_metric2</CODE> stores the type 2 metric. Note that in such cases if
<CODE>ospf_metric1</CODE> is non-zero then <CODE>ospf_metric2</CODE> is increased by one to
ensure monotonicity of metric, as internal distance is reset to zero when an
external route is announced.
<P>
<P>Each external route can also carry attribute <CODE>ospf_tag</CODE> which is a 32-bit
integer which is used when exporting routes to other protocols; otherwise, it
doesn't affect routing inside the OSPF domain at all. The fourth attribute
<CODE>ospf_router_id</CODE> is a router ID of the router advertising that route /
network. This attribute is read-only. Default is <CODE>ospf_metric2 = 10000</CODE> and
<CODE>ospf_tag = 0</CODE>.
<P>
<H3><A NAME="ospf-exam"></A> Example</H3>

<P>
<HR>
<PRE>
protocol ospf MyOSPF {
        ipv4 {
                export filter {
                        if source = RTS_BGP then {
                                ospf_metric1 = 100;
                                accept;
                        }
                        reject;
                };
        };
        area 0.0.0.0 {
                interface "eth*" {
                        cost 11;
                        hello 15;
                        priority 100;
                        retransmit 7;
                        authentication simple;
                        password "aaa";
                };
                interface "ppp*" {
                        cost 100;
                        authentication cryptographic;
                        password "abc" {
                                id 1;
                                generate to "22-04-2003 11:00:06";
                                accept from "17-01-2001 12:01:05";
                                algorithm hmac sha384;
                        };
                        password "def" {
                                id 2;
                                generate to "22-07-2005 17:03:21";
                                accept from "22-02-2001 11:34:06";
                                algorithm hmac sha512;
                        };
                };
                interface "arc0" {
                        cost 10;
                        stub yes;
                };
                interface "arc1";
        };
        area 120 {
                stub yes;
                networks {
                        172.16.1.0/24;
                        172.16.2.0/24 hidden;
                }
                interface "-arc0" , "arc*" {
                        type nonbroadcast;
                        authentication none;
                        strict nonbroadcast yes;
                        wait 120;
                        poll 40;
                        dead count 8;
                        neighbors {
                                192.168.120.1 eligible;
                                192.168.120.2;
                                192.168.120.10;
                        };
                };
        };
}
</PRE>
<HR>
<P>
<H2><A NAME="perf"></A> <A NAME="ss6.9">6.9</A> <A HREF="bird.html#toc6.9">Perf</A>
</H2>

<H3><A NAME="perf-intro"></A> Introduction</H3>

<P>The Perf protocol is a generator of fake routes together with a time measurement
framework. Its purpose is to check BIRD performance and to benchmark filters.
<P>
<P>Import mode of this protocol runs in several steps. In each step, it generates 2^x routes,
imports them into the appropriate table and withdraws them. The exponent x is configurable.
It runs the benchmark several times for the same x, then it increases x by one
until it gets too high, then it stops.
<P>
<P>Export mode of this protocol repeats route refresh from table and measures how long it takes.
<P>
<P>Output data is logged on info level. There is a Perl script <CODE>proto/perf/parse.pl</CODE>
which may be handy to parse the data and draw some plots.
<P>
<P>Implementation of this protocol is experimental. Use with caution and do not keep
any instance of Perf in production configs for long time. The config interface is also unstable
and may change in future versions without warning.
<P>
<H3><A NAME="perf-config"></A> Configuration</H3>

<P>
<DL>
<DT><CODE>
<A NAME="perf-mode"></A> mode import|export</CODE><DD><P>Set perf mode. Default: import
<P>
<DT><CODE>
<A NAME="perf-repeat"></A> repeat <I>number</I></CODE><DD><P>Run this amount of iterations of the benchmark for every amount step. Default: 4
<P>
<DT><CODE>
<A NAME="perf-from"></A> exp from <I>number</I></CODE><DD><P>Begin benchmarking on this exponent for number of generated routes in one step.
Default: 10
<P>
<DT><CODE>
<A NAME="perf-to"></A> exp to <I>number</I></CODE><DD><P>Stop benchmarking on this exponent. Default: 20
<P>
<DT><CODE>
<A NAME="perf-threshold-min"></A> threshold min <I>time</I></CODE><DD><P>If a run for the given exponent took less than this time for route import,
increase the exponent immediately. Default: 1 ms
<P>
<DT><CODE>
<A NAME="perf-threshold-max"></A> threshold max <I>time</I></CODE><DD><P>If every run for the given exponent took at least this time for route import,
stop benchmarking. Default: 500 ms
</DL>
<P>
<H2><A NAME="pipe"></A> <A NAME="ss6.10">6.10</A> <A HREF="bird.html#toc6.10">Pipe</A>
</H2>

<H3><A NAME="pipe-intro"></A> Introduction</H3>

<P>The Pipe protocol serves as a link between two routing tables, allowing
routes to be passed from a table declared as primary (i.e., the one the pipe is
connected to using the <CODE>table</CODE> configuration keyword) to the secondary one
(declared using <CODE>peer table</CODE>) and vice versa, depending on what's allowed by
the filters. Export filters control export of routes from the primary table to
the secondary one, import filters control the opposite direction. Both tables
must be of the same nettype.
<P>
<P>The Pipe protocol retransmits all routes from one table to the other table,
retaining their original source and attributes. If import and export filters
are set to accept, then both tables would have the same content.
<P>
<P>The primary use of multiple routing tables and the Pipe protocol is for
policy routing, where handling of a single packet doesn't depend only on its
destination address, but also on its source address, source interface, protocol
type and other similar parameters. In many systems (Linux being a good example),
the kernel allows to enforce routing policies by defining routing rules which
choose one of several routing tables to be used for a packet according to its
parameters. Setting of these rules is outside the scope of BIRD's work (on
Linux, you can use the <CODE>ip</CODE> command), but you can create several routing
tables in BIRD, connect them to the kernel ones, use filters to control which
routes appear in which tables and also you can employ the Pipe protocol for
exporting a selected subset of one table to another one.
<P>
<H3><A NAME="pipe-config"></A> Configuration</H3>

<P>Essentially, the Pipe protocol is just a channel connected to a table on both
sides. Therefore, the configuration block for <CODE>protocol pipe</CODE> shall directly
include standard channel config options; see the example below.
<P>
<P>
<DL>
<DT><CODE>
<A NAME="pipe-peer-table"></A> peer table <I>table</I></CODE><DD><P>Defines secondary routing table to connect to. The primary one is
selected by the <CODE>table</CODE> keyword.
</DL>
<P>
<H3><A NAME="pipe-attr"></A> Attributes</H3>

<P>The Pipe protocol doesn't define any route attributes.
<P>
<H3><A NAME="pipe-exam"></A> Example</H3>

<P>Let's consider a router which serves as a boundary router of two different
autonomous systems, each of them connected to a subset of interfaces of the
router, having its own exterior connectivity and wishing to use the other AS as
a backup connectivity in case of outage of its own exterior line.
<P>
<P>Probably the simplest solution to this situation is to use two routing tables
(we'll call them <CODE>as1</CODE> and <CODE>as2</CODE>) and set up kernel routing rules, so that
packets having arrived from interfaces belonging to the first AS will be routed
according to <CODE>as1</CODE> and similarly for the second AS. Thus we have split our
router to two logical routers, each one acting on its own routing table, having
its own routing protocols on its own interfaces. In order to use the other AS's
routes for backup purposes, we can pass the routes between the tables through a
Pipe protocol while decreasing their preferences and correcting their BGP paths
to reflect the AS boundary crossing.
<P>
<HR>
<PRE>
ipv4 table as1;                         # Define the tables
ipv4 table as2;

protocol kernel kern1 {                 # Synchronize them with the kernel
        ipv4 { table as1; export all; };
        kernel table 1;
}

protocol kernel kern2 {
        ipv4 { table as2; export all; };
        kernel table 2;
}

protocol bgp bgp1 {                     # The outside connections
        ipv4 { table as1; import all; export all; };
        local as 1;
        neighbor 192.168.0.1 as 1001;
}

protocol bgp bgp2 {
        ipv4 { table as2; import all; export all; };
        local as 2;
        neighbor 10.0.0.1 as 1002;
}

protocol pipe {                         # The Pipe
        table as1;
        peer table as2;
        export filter {
                if net ~ [ 1.0.0.0/8+] then {   # Only AS1 networks
                        if preference>10 then preference = preference-10;
                        if source=RTS_BGP then bgp_path.prepend(1);
                        accept;
                }
                reject;
        };
        import filter {
                if net ~ [ 2.0.0.0/8+] then {   # Only AS2 networks
                        if preference>10 then preference = preference-10;
                        if source=RTS_BGP then bgp_path.prepend(2);
                        accept;
                }
                reject;
        };
}
</PRE>
<HR>
<P>
<P>
<H2><A NAME="radv"></A> <A NAME="ss6.11">6.11</A> <A HREF="bird.html#toc6.11">RAdv</A>
</H2>

<H3><A NAME="radv-intro"></A> Introduction</H3>

<P>The RAdv protocol is an implementation of Router Advertisements, which are
used in the IPv6 stateless autoconfiguration. IPv6 routers send (in irregular
time intervals or as an answer to a request) advertisement packets to connected
networks. These packets contain basic information about a local network (e.g. a
list of network prefixes), which allows network hosts to autoconfigure network
addresses and choose a default route. BIRD implements router behavior as defined
in <A HREF="http://www.rfc-editor.org/info/rfc4861">RFC 4861</A>, router preferences and specific routes (<A HREF="http://www.rfc-editor.org/info/rfc4191">RFC 4191</A>),
and DNS extensions (<A HREF="http://www.rfc-editor.org/info/rfc6106">RFC 6106</A>).
<P>
<P>The RAdv protocols supports just IPv6 channel.
<P>
<H3><A NAME="radv-config"></A> Configuration</H3>

<P>There are several classes of definitions in RAdv configuration -- interface
definitions, prefix definitions and DNS definitions:
<P>
<DL>
<DT><CODE>
<A NAME="radv-iface"></A> interface <I>pattern</I> [, <I>...</I>] { <I>options</I> }</CODE><DD><P>Interface definitions specify a set of interfaces on which the
protocol is activated and contain interface specific options.
See 
<A HREF="bird-3.html#proto-iface">interface</A> common options for
detailed description.
<P>
<DT><CODE>
<A NAME="radv-prefix"></A> prefix <I>prefix</I> { <I>options</I> }</CODE><DD><P>Prefix definitions allow to modify a list of advertised prefixes. By
default, the advertised prefixes are the same as the network prefixes
assigned to the interface. For each network prefix, the matching prefix
definition is found and its options are used. If no matching prefix
definition is found, the prefix is used with default options.
<P>Prefix definitions can be either global or interface-specific. The
second ones are part of interface options. The prefix definition
matching is done in the first-match style, when interface-specific
definitions are processed before global definitions. As expected, the
prefix definition is matching if the network prefix is a subnet of the
prefix in prefix definition.
<P>
<DT><CODE>
<A NAME="radv-rdnss"></A> rdnss { <I>options</I> }</CODE><DD><P>RDNSS definitions allow to specify a list of advertised recursive DNS
servers together with their options. As options are seldom necessary,
there is also a short variant <CODE>rdnss <I>address</I></CODE> that just
specifies one DNS server. Multiple definitions are cumulative. RDNSS
definitions may also be interface-specific when used inside interface
options. By default, interface uses both global and interface-specific
options, but that can be changed by <CODE>rdnss local</CODE> option.
<P>
<DT><CODE>
<A NAME="radv-dnssl"></A> dnssl { <I>options</I> }</CODE><DD><P>DNSSL definitions allow to specify a list of advertised DNS search
domains together with their options. Like <CODE>rdnss</CODE> above, multiple
definitions are cumulative, they can be used also as interface-specific
options and there is a short variant <CODE>dnssl <I>domain</I></CODE> that just
specifies one DNS search domain.
<P>
<DT><CODE>
<A NAME="radv-trigger"></A> trigger <I>prefix</I></CODE><DD><P>RAdv protocol could be configured to change its behavior based on
availability of routes. When this option is used, the protocol waits in
suppressed state until a <I>trigger route</I> (for the specified network)
is exported to the protocol, the protocol also returns to suppressed
state if the <I>trigger route</I> disappears. Note that route export
depends on specified export filter, as usual. This option could be used,
e.g., for handling failover in multihoming scenarios.
<P>During suppressed state, router advertisements are generated, but with
some fields zeroed. Exact behavior depends on which fields are zeroed,
this can be configured by <CODE>sensitive</CODE> option for appropriate
fields. By default, just <CODE>default lifetime</CODE> (also called <CODE>router
lifetime</CODE>) is zeroed, which means hosts cannot use the router as a
default router. <CODE>preferred lifetime</CODE> and <CODE>valid lifetime</CODE> could
also be configured as <CODE>sensitive</CODE> for a prefix, which would cause
autoconfigured IPs to be deprecated or even removed.
<P>
<DT><CODE>
<A NAME="radv-propagate-routes"></A> propagate routes <I>switch</I></CODE><DD><P>This option controls propagation of more specific routes, as defined in
<A HREF="http://www.rfc-editor.org/info/rfc4191">RFC 4191</A>. If enabled, all routes exported to the RAdv protocol,
with the exception of the trigger prefix, are added to advertisments as
additional options. The lifetime and preference of advertised routes can
be set individually by <CODE>ra_lifetime</CODE> and <CODE>ra_preference</CODE> route
attributes, or per interface by <CODE>route lifetime</CODE> and
<CODE>route preference</CODE> options. Default: disabled.
<P>Note that the RFC discourages from sending more than 17 routes and
recommends the routes to be configured manually.
</DL>
<P>
<P>Interface specific options:
<P>
<DL>
<DT><CODE>
<A NAME="radv-iface-max-ra-interval"></A> max ra interval <I>expr</I></CODE><DD><P>Unsolicited router advertisements are sent in irregular time intervals.
This option specifies the maximum length of these intervals, in seconds.
Valid values are 4-1800. Default: 600
<P>
<DT><CODE>
<A NAME="radv-iface-min-ra-interval"></A> min ra interval <I>expr</I></CODE><DD><P>This option specifies the minimum length of that intervals, in seconds.
Must be at least 3 and at most 3/4 * <CODE>max ra interval</CODE>. Default:
about 1/3 * <CODE>max ra interval</CODE>.
<P>
<DT><CODE>
<A NAME="radv-iface-min-delay"></A> min delay <I>expr</I></CODE><DD><P>The minimum delay between two consecutive router advertisements, in
seconds. Default: 3
<P>
<DT><CODE>
<A NAME="radv-solicited-ra-unicast"></A> solicited ra unicast <I>switch</I></CODE><DD><P>Solicited router advertisements are usually sent to all-nodes multicast
group like unsolicited ones, but the router can be configured to send
them as unicast directly to soliciting nodes instead. This is especially
useful on wireless networks (see <A HREF="http://www.rfc-editor.org/info/rfc7772">RFC 7772</A>). Default: no
<P>
<DT><CODE>
<A NAME="radv-iface-managed"></A> managed <I>switch</I></CODE><DD><P>This option specifies whether hosts should use DHCPv6 for IP address
configuration. Default: no
<P>
<DT><CODE>
<A NAME="radv-iface-other-config"></A> other config <I>switch</I></CODE><DD><P>This option specifies whether hosts should use DHCPv6 to receive other
configuration information. Default: no
<P>
<DT><CODE>
<A NAME="radv-iface-link-mtu"></A> link mtu <I>expr</I></CODE><DD><P>This option specifies which value of MTU should be used by hosts. 0
means unspecified. Default: 0
<P>
<DT><CODE>
<A NAME="radv-iface-reachable-time"></A> reachable time <I>expr</I></CODE><DD><P>This option specifies the time (in milliseconds) how long hosts should
assume a neighbor is reachable (from the last confirmation). Maximum is
3600000, 0 means unspecified. Default 0.
<P>
<DT><CODE>
<A NAME="radv-iface-retrans-timer"></A> retrans timer <I>expr</I></CODE><DD><P>This option specifies the time (in milliseconds) how long hosts should
wait before retransmitting Neighbor Solicitation messages. 0 means
unspecified. Default 0.
<P>
<DT><CODE>
<A NAME="radv-iface-current-hop-limit"></A> current hop limit <I>expr</I></CODE><DD><P>This option specifies which value of Hop Limit should be used by
hosts. Valid values are 0-255, 0 means unspecified. Default: 64
<P>
<DT><CODE>
<A NAME="radv-iface-default-lifetime"></A> default lifetime <I>expr</I> [sensitive <I>switch</I>]</CODE><DD><P>This option specifies the time (in seconds) how long (since the receipt
of RA) hosts may use the router as a default router. 0 means do not use
as a default router. For <CODE>sensitive</CODE> option, see 
<A HREF="#radv-trigger">trigger</A>.
Default: 3 * <CODE>max ra       interval</CODE>, <CODE>sensitive</CODE> yes.
<P>
<DT><CODE>
<A NAME="radv-iface-default-preference"></A> default preference low|medium|high</CODE><DD><P>This option specifies the Default Router Preference value to advertise
to hosts. Default: medium.
<P>
<DT><CODE>
<A NAME="radv-iface-route-lifetime"></A> route lifetime <I>expr</I> [sensitive <I>switch</I>]</CODE><DD><P>This option specifies the default value of advertised lifetime for
specific routes; i.e., the time (in seconds) for how long (since the
receipt of RA) hosts should consider these routes valid. A special value
0xffffffff represents infinity. The lifetime can be overriden on a per
route basis by the 
<A HREF="#rta-ra-lifetime">ra_lifetime</A> route
attribute. Default: 3 * <CODE>max ra interval</CODE>, <CODE>sensitive</CODE> no.
<P>For the <CODE>sensitive</CODE> option, see 
<A HREF="#radv-trigger">trigger</A>.
If <CODE>sensitive</CODE> is enabled, even the routes with the <CODE>ra_lifetime</CODE>
attribute become sensitive to the trigger.
<P>
<DT><CODE>
<A NAME="radv-iface-route-preference"></A> route preference low|medium|high</CODE><DD><P>This option specifies the default value of advertised route preference
for specific routes. The value can be overriden on a per route basis by
the 
<A HREF="#rta-ra-preference">ra_preference</A> route attribute.
Default: medium.
<P>
<DT><CODE>
<A NAME="radv-prefix-linger-time"></A> prefix linger time <I>expr</I></CODE><DD><P>When a prefix or a route disappears, it is advertised for some time with
zero lifetime, to inform clients it is no longer valid. This option
specifies the time (in seconds) for how long prefixes are advertised
that way. Default: 3 * <CODE>max ra interval</CODE>.
<P>
<DT><CODE>
<A NAME="radv-route-linger-time"></A> route linger time <I>expr</I></CODE><DD><P>When a prefix or a route disappears, it is advertised for some time with
zero lifetime, to inform clients it is no longer valid. This option
specifies the time (in seconds) for how long routes are advertised
that way. Default: 3 * <CODE>max ra interval</CODE>.
<P>
<DT><CODE>
<A NAME="radv-iface-rdnss-local"></A> rdnss local <I>switch</I></CODE><DD><P>Use only local (interface-specific) RDNSS definitions for this
interface. Otherwise, both global and local definitions are used. Could
also be used to disable RDNSS for given interface if no local definitons
are specified. Default: no.
<P>
<DT><CODE>
<A NAME="radv-iface-dnssl-local"></A> dnssl local <I>switch</I></CODE><DD><P>Use only local DNSSL definitions for this interface. See <CODE>rdnss local</CODE>
option above. Default: no.
</DL>
<P>
<P>Prefix specific options
<P>
<DL>
<DT><CODE>
<A NAME="radv-prefix-skip"></A> skip <I>switch</I></CODE><DD><P>This option allows to specify that given prefix should not be
advertised. This is useful for making exceptions from a default policy
of advertising all prefixes. Note that for withdrawing an already
advertised prefix it is more useful to advertise it with zero valid
lifetime. Default: no
<P>
<DT><CODE>
<A NAME="radv-prefix-onlink"></A> onlink <I>switch</I></CODE><DD><P>This option specifies whether hosts may use the advertised prefix for
onlink determination. Default: yes
<P>
<DT><CODE>
<A NAME="radv-prefix-autonomous"></A> autonomous <I>switch</I></CODE><DD><P>This option specifies whether hosts may use the advertised prefix for
stateless autoconfiguration. Default: yes
<P>
<DT><CODE>
<A NAME="radv-prefix-valid-lifetime"></A> valid lifetime <I>expr</I> [sensitive <I>switch</I>]</CODE><DD><P>This option specifies the time (in seconds) how long (after the
receipt of RA) the prefix information is valid, i.e., autoconfigured
IP addresses can be assigned and hosts with that IP addresses are
considered directly reachable. 0 means the prefix is no longer
valid. For <CODE>sensitive</CODE> option, see 
<A HREF="#radv-trigger">trigger</A>.
Default: 86400 (1 day), <CODE>sensitive</CODE> no.
<P>
<DT><CODE>
<A NAME="radv-prefix-preferred-lifetime"></A> preferred lifetime <I>expr</I> [sensitive <I>switch</I>]</CODE><DD><P>This option specifies the time (in seconds) how long (after the
receipt of RA) IP addresses generated from the prefix using stateless
autoconfiguration remain preferred. For <CODE>sensitive</CODE> option,
see 
<A HREF="#radv-trigger">trigger</A>. Default: 14400 (4 hours),
<CODE>sensitive</CODE> no.
</DL>
<P>
<P>RDNSS specific options:
<P>
<DL>
<DT><CODE>
<A NAME="radv-rdnss-ns"></A> ns <I>address</I></CODE><DD><P>This option specifies one recursive DNS server. Can be used multiple
times for multiple servers. It is mandatory to have at least one
<CODE>ns</CODE> option in <CODE>rdnss</CODE> definition.
<P>
<DT><CODE>
<A NAME="radv-rdnss-lifetime"></A> lifetime [mult] <I>expr</I></CODE><DD><P>This option specifies the time how long the RDNSS information may be
used by clients after the receipt of RA. It is expressed either in
seconds or (when <CODE>mult</CODE> is used) in multiples of <CODE>max ra
interval</CODE>. Note that RDNSS information is also invalidated when
<CODE>default lifetime</CODE> expires. 0 means these addresses are no longer
valid DNS servers. Default: 3 * <CODE>max ra interval</CODE>.
</DL>
<P>
<P>DNSSL specific options:
<P>
<DL>
<DT><CODE>
<A NAME="radv-dnssl-domain"></A> domain <I>address</I></CODE><DD><P>This option specifies one DNS search domain. Can be used multiple times
for multiple domains. It is mandatory to have at least one <CODE>domain</CODE>
option in <CODE>dnssl</CODE> definition.
<P>
<DT><CODE>
<A NAME="radv-dnssl-lifetime"></A> lifetime [mult] <I>expr</I></CODE><DD><P>This option specifies the time how long the DNSSL information may be
used by clients after the receipt of RA. Details are the same as for
RDNSS <CODE>lifetime</CODE> option above. Default: 3 * <CODE>max ra interval</CODE>.
</DL>
<P>
<H3><A NAME="radv-attr"></A> Attributes</H3>

<P>RAdv defines two route attributes:
<P>
<DL>
<DT><CODE>
<A NAME="rta-ra-preference"></A> enum ra_preference</CODE><DD><P>The preference of the route. The value can be <I>RA_PREF_LOW</I>,
<I>RA_PREF_MEDIUM</I> or <I>RA_PREF_HIGH</I>. If the attribute is not set,
the 
<A HREF="#radv-iface-route-preference">route preference</A>
option is used.
<P>
<DT><CODE>
<A NAME="rta-ra-lifetime"></A> int ra_lifetime</CODE><DD><P>The advertised lifetime of the route, in seconds. The special value of
0xffffffff represents infinity. If the attribute is not set, the
<A HREF="#radv-iface-route-lifetime">route lifetime</A>
option is used.
</DL>
<P>
<H3><A NAME="radv-exam"></A> Example</H3>

<P>
<HR>
<PRE>
ipv6 table radv_routes;                 # Manually configured routes go here

protocol static {
        ipv6 { table radv_routes; };

        route 2001:0DB8:4000::/48 unreachable;
        route 2001:0DB8:4010::/48 unreachable;

        route 2001:0DB8:4020::/48 unreachable {
                ra_preference = RA_PREF_HIGH;
                ra_lifetime = 3600;
        };
}

protocol radv {
        propagate routes yes;           # Propagate the routes from the radv_routes table
        ipv6 { table radv_routes; export all; };

        interface "eth2" {
                max ra interval 5;      # Fast failover with more routers
                managed yes;            # Using DHCPv6 on eth2
                prefix ::/0 {
                        autonomous off; # So do not autoconfigure any IP
                };
        };

        interface "eth*";               # No need for any other options

        prefix 2001:0DB8:1234::/48 {
                preferred lifetime 0;   # Deprecated address range
        };

        prefix 2001:0DB8:2000::/48 {
                autonomous off;         # Do not autoconfigure
        };

        rdnss 2001:0DB8:1234::10;       # Short form of RDNSS

        rdnss {
                lifetime mult 10;
                ns 2001:0DB8:1234::11;
                ns 2001:0DB8:1234::12;
        };

        dnssl {
                lifetime 3600;
                domain "abc.com";
                domain "xyz.com";
        };
}
</PRE>
<HR>
<P>
<P>
<H2><A NAME="rip"></A> <A NAME="ss6.12">6.12</A> <A HREF="bird.html#toc6.12">RIP</A>
</H2>

<H3><A NAME="rip-intro"></A> Introduction</H3>

<P>The RIP protocol (also sometimes called Rest In Pieces) is a simple protocol,
where each router broadcasts (to all its neighbors) distances to all networks it
can reach. When a router hears distance to another network, it increments it and
broadcasts it back. Broadcasts are done in regular intervals. Therefore, if some
network goes unreachable, routers keep telling each other that its distance is
the original distance plus 1 (actually, plus interface metric, which is usually
one). After some time, the distance reaches infinity (that's 15 in RIP) and all
routers know that network is unreachable. RIP tries to minimize situations where
counting to infinity is necessary, because it is slow. Due to infinity being 16,
you can't use RIP on networks where maximal distance is higher than 15
hosts.
<P>
<P>BIRD supports RIPv1 (<A HREF="http://www.rfc-editor.org/info/rfc1058">RFC 1058</A>), RIPv2 (<A HREF="http://www.rfc-editor.org/info/rfc2453">RFC 2453</A>), RIPng (<A HREF="http://www.rfc-editor.org/info/rfc2080">RFC 2080</A>), and RIP cryptographic authentication (<A HREF="http://www.rfc-editor.org/info/rfc4822">RFC 4822</A>).
<P>
<P>RIP is a very simple protocol, and it has a lot of shortcomings. Slow
convergence, big network load and inability to handle larger networks makes it
pretty much obsolete. It is still usable on very small networks.
<P>
<H3><A NAME="rip-config"></A> Configuration</H3>

<P>RIP configuration consists mainly of common protocol options and interface
definitions, most RIP options are interface specific. RIPng (RIP for IPv6)
protocol instance can be configured by using <CODE>rip ng</CODE> instead of just
<CODE>rip</CODE> as a protocol type.
<P>
<P>RIP needs one IPv4 channel. RIPng needs one IPv6 channel. If no channel is
configured, appropriate channel is defined with default parameters.
<P>
<HR>
<PRE>
protocol rip [ng] [&lt;name&gt;] {
        infinity &lt;number&gt;;
        ecmp &lt;switch&gt; [limit &lt;number&gt;];
        interface &lt;interface pattern&gt; {
                metric &lt;number&gt;;
                mode multicast|broadcast;
                passive &lt;switch&gt;;
                address &lt;ip&gt;;
                port &lt;number&gt;;
                version 1|2;
                split horizon &lt;switch&gt;;
                poison reverse &lt;switch&gt;;
                check zero &lt;switch&gt;;
                update time &lt;number&gt;;
                timeout time &lt;number&gt;;
                garbage time &lt;number&gt;;
                ecmp weight &lt;number&gt;;
                ttl security &lt;switch&gt;; | tx only;
                tx class|dscp &lt;number&gt;;
                tx priority &lt;number&gt;;
                rx buffer &lt;number&gt;;
                tx length &lt;number&gt;;
                check link &lt;switch&gt;;
                authentication none|plaintext|cryptographic;
                password "&lt;text&gt;";
                password "&lt;text&gt;" {
                        id &lt;num&gt;;
                        generate from "&lt;date&gt;";
                        generate to "&lt;date&gt;";
                        accept from "&lt;date&gt;";
                        accept to "&lt;date&gt;";
                        from "&lt;date&gt;";
                        to "&lt;date&gt;";
                        algorithm ( keyed md5 | keyed sha1 | hmac sha1 | hmac sha256 | hmac sha384 | hmac sha512 );
                };
        };
}
</PRE>
<HR>
<P>
<DL>
<DT><CODE>
<A NAME="rip-infinity"></A> infinity <I>number</I></CODE><DD><P>Selects the distance of infinity. Bigger values will make
protocol convergence even slower. The default value is 16.
<P>
<DT><CODE>
<A NAME="rip-ecmp"></A> ecmp <I>switch</I> [limit <I>number</I>]</CODE><DD><P>This option specifies whether RIP is allowed to generate ECMP
(equal-cost multipath) routes. Such routes are used when there are
several directions to the destination, each with the same (computed)
cost. This option also allows to specify a limit on maximum number of
nexthops in one route. By default, ECMP is enabled if supported by
Kernel. Default value of the limit is 16.
<P>
<DT><CODE>
<A NAME="rip-iface"></A> interface <I>pattern</I> [, <I>...</I>] { <I>options</I> }</CODE><DD><P>Interface definitions specify a set of interfaces on which the
protocol is activated and contain interface specific options.
See 
<A HREF="bird-3.html#proto-iface">interface</A> common options for
detailed description.
</DL>
<P>
<P>Interface specific options:
<P>
<DL>
<DT><CODE>
<A NAME="rip-iface-metric"></A> metric <I>num</I></CODE><DD><P>This option specifies the metric of the interface. When a route is
received from the interface, its metric is increased by this value
before further processing. Valid values are 1-255, but values higher
than infinity has no further meaning. Default: 1.
<P>
<DT><CODE>
<A NAME="rip-iface-mode"></A> mode multicast|broadcast</CODE><DD><P>This option selects the mode for RIP to use on the interface. The
default is multicast mode for RIPv2 and broadcast mode for RIPv1.
RIPng always uses the multicast mode.
<P>
<DT><CODE>
<A NAME="rip-iface-passive"></A> passive <I>switch</I></CODE><DD><P>Passive interfaces receive routing updates but do not transmit any
messages. Default: no.
<P>
<DT><CODE>
<A NAME="rip-iface-address"></A> address <I>ip</I></CODE><DD><P>This option specifies a destination address used for multicast or
broadcast messages, the default is the official RIP (224.0.0.9) or RIPng
(ff02::9) multicast address, or an appropriate broadcast address in the
broadcast mode.
<P>
<DT><CODE>
<A NAME="rip-iface-port"></A> port <I>number</I></CODE><DD><P>This option selects an UDP port to operate on, the default is the
official RIP (520) or RIPng (521) port.
<P>
<DT><CODE>
<A NAME="rip-iface-version"></A> version 1|2</CODE><DD><P>This option selects the version of RIP used on the interface. For RIPv1,
automatic subnet aggregation is not implemented, only classful network
routes and host routes are propagated. Note that BIRD allows RIPv1 to be
configured with features that are defined for RIPv2 only, like
authentication or using multicast sockets. The default is RIPv2 for IPv4
RIP, the option is not supported for RIPng, as no further versions are
defined.
<P>
<DT><CODE>
<A NAME="rip-iface-version-only"></A> version only <I>switch</I></CODE><DD><P>Regardless of RIP version configured for the interface, BIRD accepts
incoming packets of any RIP version. This option restrict accepted
packets to the configured version. Default: no.
<P>
<DT><CODE>
<A NAME="rip-iface-split-horizon"></A> split horizon <I>switch</I></CODE><DD><P>Split horizon is a scheme for preventing routing loops. When split
horizon is active, routes are not regularly propagated back to the
interface from which they were received. They are either not propagated
back at all (plain split horizon) or propagated back with an infinity
metric (split horizon with poisoned reverse). Therefore, other routers
on the interface will not consider the router as a part of an
independent path to the destination of the route. Default: yes.
<P>
<DT><CODE>
<A NAME="rip-iface-poison-reverse"></A> poison reverse <I>switch</I></CODE><DD><P>When split horizon is active, this option specifies whether the poisoned
reverse variant (propagating routes back with an infinity metric) is
used. The poisoned reverse has some advantages in faster convergence,
but uses more network traffic. Default: yes.
<P>
<DT><CODE>
<A NAME="rip-iface-check-zero"></A> check zero <I>switch</I></CODE><DD><P>Received RIPv1 packets with non-zero values in reserved fields should
be discarded. This option specifies whether the check is performed or
such packets are just processed as usual. Default: yes.
<P>
<DT><CODE>
<A NAME="rip-iface-update-time"></A> update time <I>number</I></CODE><DD><P>Specifies the number of seconds between periodic updates. A lower number
will mean faster convergence but bigger network load. Default: 30.
<P>
<DT><CODE>
<A NAME="rip-iface-timeout-time"></A> timeout time <I>number</I></CODE><DD><P>Specifies the time interval (in seconds) between the last received route
announcement and the route expiration. After that, the network is
considered unreachable, but still is propagated with infinity distance.
Default: 180.
<P>
<DT><CODE>
<A NAME="rip-iface-garbage-time"></A> garbage time <I>number</I></CODE><DD><P>Specifies the time interval (in seconds) between the route expiration
and the removal of the unreachable network entry. The garbage interval,
when a route with infinity metric is propagated, is used for both
internal (after expiration) and external (after withdrawal) routes.
Default: 120.
<P>
<DT><CODE>
<A NAME="rip-iface-ecmp-weight"></A> ecmp weight <I>number</I></CODE><DD><P>When ECMP (multipath) routes are allowed, this value specifies a
relative weight used for nexthops going through the iface. Valid
values are 1-256. Default value is 1.
<P>
<DT><CODE>
<A NAME="rip-iface-auth"></A> authentication none|plaintext|cryptographic</CODE><DD><P>Selects authentication method to be used. <CODE>none</CODE> means that packets
are not authenticated at all, <CODE>plaintext</CODE> means that a plaintext
password is embedded into each packet, and <CODE>cryptographic</CODE> means that
packets are authenticated using some cryptographic hash function
selected by option <CODE>algorithm</CODE> for each key. The default
cryptographic algorithm for RIP keys is Keyed-MD5. If you set
authentication to not-none, it is a good idea to add <CODE>password</CODE>
section. Default: none.
<P>
<DT><CODE>
<A NAME="rip-iface-pass"></A> password "<I>text</I>"</CODE><DD><P>Specifies a password used for authentication. See 
<A HREF="bird-3.html#proto-pass">password</A> common option for detailed description.
<P>
<DT><CODE>
<A NAME="rip-iface-ttl-security"></A> ttl security [<I>switch</I> | tx only]</CODE><DD><P>TTL security is a feature that protects routing protocols from remote
spoofed packets by using TTL 255 instead of TTL 1 for protocol packets
destined to neighbors. Because TTL is decremented when packets are
forwarded, it is non-trivial to spoof packets with TTL 255 from remote
locations.
<P>If this option is enabled, the router will send RIP packets with TTL 255
and drop received packets with TTL less than 255. If this option si set
to <CODE>tx only</CODE>, TTL 255 is used for sent packets, but is not checked
for received packets. Such setting does not offer protection, but offers
compatibility with neighbors regardless of whether they use ttl
security.
<P>For RIPng, TTL security is a standard behavior (required by <A HREF="http://www.rfc-editor.org/info/rfc2080">RFC 2080</A>) and therefore default value is yes. For IPv4 RIP, default
value is no.
<P>
<DT><CODE>
<A NAME="rip-iface-tx-class"></A> tx class|dscp|priority <I>number</I></CODE><DD><P>These options specify the ToS/DiffServ/Traffic class/Priority of the
outgoing RIP packets. See 
<A HREF="bird-3.html#proto-tx-class">tx class</A> common
option for detailed description.
<P>
<DT><CODE>
<A NAME="rip-iface-rx-buffer"></A> rx buffer <I>number</I></CODE><DD><P>This option specifies the size of buffers used for packet processing.
The buffer size should be bigger than maximal size of received packets.
The default value is 532 for IPv4 RIP and interface MTU value for RIPng.
<P>
<DT><CODE>
<A NAME="rip-iface-tx-length"></A> tx length <I>number</I></CODE><DD><P>This option specifies the maximum length of generated RIP packets. To
avoid IP fragmentation, it should not exceed the interface MTU value.
The default value is 532 for IPv4 RIP and interface MTU value for RIPng.
<P>
<DT><CODE>
<A NAME="rip-iface-check-link"></A> check link <I>switch</I></CODE><DD><P>If set, the hardware link state (as reported by OS) is taken into
consideration. When the link disappears (e.g. an ethernet cable is
unplugged), neighbors are immediately considered unreachable and all
routes received from them are withdrawn. It is possible that some
hardware drivers or platforms do not implement this feature.
Default: yes.
</DL>
<P>
<H3><A NAME="rip-attr"></A> Attributes</H3>

<P>RIP defines two route attributes:
<P>
<DL>
<DT><CODE>
<A NAME="rta-rip-metric"></A> int rip_metric</CODE><DD><P>RIP metric of the route (ranging from 0 to <CODE>infinity</CODE>). When routes
from different RIP instances are available and all of them have the same
preference, BIRD prefers the route with lowest <CODE>rip_metric</CODE>. When a
non-RIP route is exported to RIP, the default metric is 1.
<P>
<DT><CODE>
<A NAME="rta-rip-tag"></A> int rip_tag</CODE><DD><P>RIP route tag: a 16-bit number which can be used to carry additional
information with the route (for example, an originating AS number in
case of external routes). When a non-RIP route is exported to RIP, the
default tag is 0.
</DL>
<P>
<H3><A NAME="rip-exam"></A> Example</H3>

<P>
<HR>
<PRE>
protocol rip {
        ipv4 {
                import all;
                export all;
        };
        interface "eth*" {
                metric 2;
                port 1520;
                mode multicast;
                update time 12;
                timeout time 60;
                authentication cryptographic;
                password "secret" { algorithm hmac sha256; };
        };
}
</PRE>
<HR>
<P>
<P>
<H2><A NAME="rpki"></A> <A NAME="ss6.13">6.13</A> <A HREF="bird.html#toc6.13">RPKI</A>
</H2>

<H3>Introduction</H3>

<P>The Resource Public Key Infrastructure (RPKI) is mechanism for origin
validation of BGP routes (RFC 6480). BIRD supports only so-called RPKI-based
origin validation. There is implemented RPKI to Router (RPKI-RTR) protocol (RFC
6810). It uses some of the RPKI data to allow a router to verify that the
autonomous system announcing an IP address prefix is in fact authorized to do
so. This is not crypto checked so can be violated. But it should prevent the
vast majority of accidental hijackings on the Internet today, e.g. the famous
Pakastani accidental announcement of YouTube's address space.
<P>
<P>The RPKI-RTR protocol receives and maintains a set of ROAs from a cache
server (also called validator). You can validate routes (RFC 6483) using
function <CODE>roa_check()</CODE> in filter and set it as import filter at the BGP
protocol. BIRD should re-validate all of affected routes after RPKI update by
RFC 6811, but we don't support it yet! You can use a BIRD's client command
<CODE>reload in <I>bgp_protocol_name</I></CODE> for manual call of revalidation of all
routes.
<P>
<H3>Supported transports</H3>

<P>
<UL>
<LI>Unprotected transport over TCP uses a port 323. The cache server
and BIRD router should be on the same trusted and controlled network
for security reasons.</LI>
<LI>SSHv2 encrypted transport connection uses the normal SSH port
22.</LI>
</UL>
<P>
<H3>Configuration</H3>

<P>We currently support just one cache server per protocol. However you can
define more RPKI protocols generally.
<P>
<HR>
<PRE>
protocol rpki [&lt;name&gt;] {
        roa4 { table &lt;tab&gt;; };
        roa6 { table &lt;tab&gt;; };
        remote &lt;ip&gt; | "&lt;domain&gt;" [port &lt;num&gt;];
        port &lt;num&gt;;
        refresh [keep] &lt;num&gt;;
        retry [keep] &lt;num&gt;;
        expire [keep] &lt;num&gt;;
        transport tcp;
        transport ssh {
                bird private key "&lt;/path/to/id_rsa&gt;";
                remote public key "&lt;/path/to/known_host&gt;";
                user "&lt;name&gt;";
        };
}
</PRE>
<HR>
<P>
<P>Alse note that you have to specify the ROA channel. If you want to import
only IPv4 prefixes you have to specify only roa4 channel. Similarly with IPv6
prefixes only. If you want to fetch both IPv4 and even IPv6 ROAs you have to
specify both channels.
<P>
<H3>RPKI protocol options</H3>

<P>
<DL>
<DT><CODE>remote <I>ip</I> | "<I>hostname</I>" [port <I>num</I>]</CODE><DD><P>Specifies
a destination address of the cache server.  Can be specified by an IP
address or by full domain name string.  Only one cache can be specified
per protocol. This option is required.
<P>
<DT><CODE>port <I>num</I></CODE><DD><P>Specifies the port number. The default port
number is 323 for transport without any encryption and 22 for transport
with SSH encryption.
<P>
<DT><CODE>refresh [keep] <I>num</I></CODE><DD><P>Time period in seconds. Tells how
long to wait before next attempting to poll the cache using a Serial
Query or a Reset Query packet. Must be lower than 86400 seconds (one
day). Too low value can caused a false positive detection of
network connection problems.  A keyword <CODE>keep</CODE> suppresses updating
this value by a cache server.
Default: 3600 seconds
<P>
<DT><CODE>retry [keep] <I>num</I></CODE><DD><P>Time period in seconds between a failed
Serial/Reset Query and a next attempt.  Maximum allowed value is 7200
seconds (two hours). Too low value can caused a false positive
detection of network connection problems.  A keyword <CODE>keep</CODE>
suppresses updating this value by a cache server.
Default: 600 seconds
<P>
<DT><CODE>expire [keep] <I>num</I></CODE><DD><P>Time period in seconds. Received
records are deleted if the client was unable to successfully refresh
data for this time period.  Must be in range from 600 seconds (ten
minutes) to 172800 seconds (two days).  A keyword <CODE>keep</CODE>
suppresses updating this value by a cache server.
Default: 7200 seconds
<P>
<DT><CODE>transport tcp</CODE><DD><P>Unprotected transport over TCP. It's a default
transport. Should be used only on secure private networks.
Default: tcp
<P>
<DT><CODE>transport ssh { <I>SSH transport options...</I> }</CODE><DD><P>It enables a
SSHv2 transport encryption. Cannot be combined with a TCP transport.
Default: off
</DL>
<P>
<H3>SSH transport options</H3>

<P>
<DL>
<DT><CODE>bird private key "<I>/path/to/id_rsa</I>"</CODE><DD><P>A path to the BIRD's private SSH key for authentication.
It can be a <CODE><I>id_rsa</I></CODE> file.
<P>
<DT><CODE>remote public key "<I>/path/to/known_host</I>"</CODE><DD><P>A path to the cache's public SSH key for verification identity
of the cache server. It could be a path to <CODE><I>known_host</I></CODE> file.
<P>
<DT><CODE>user "<I>name</I>"</CODE><DD><P>A SSH user name for authentication. This option is a required.
</DL>
<P>
<H3>Examples</H3>

<H3>BGP origin validation</H3>

<P>Policy: Don't import <CODE>ROA_INVALID</CODE> routes.
<HR>
<PRE>
roa4 table r4;
roa6 table r6;

protocol rpki {
        debug all;

        roa4 { table r4; };
        roa6 { table r6; };

        # Please, do not use rpki-validator.realmv6.org in production
        remote "rpki-validator.realmv6.org" port 8282;

        retry keep 5;
        refresh keep 30;
        expire 600;
}

filter peer_in_v4 {
        if (roa_check(r4, net, bgp_path.last) = ROA_INVALID) then
        {
                print "Ignore RPKI invalid ", net, " for ASN ", bgp_path.last;
                reject;
        }
        accept;
}

protocol bgp {
        debug all;
        local as 65000;
        neighbor 192.168.2.1 as 65001;
        ipv4 {
                import filter peer_in_v4;
                export none;
        };
}
</PRE>
<HR>
<P>
<H3>SSHv2 transport encryption</H3>

<P>
<HR>
<PRE>
roa4 table r4;
roa6 table r6;

protocol rpki {
        debug all;

        roa4 { table r4; };
        roa6 { table r6; };

        remote 127.0.0.1 port 2345;
        transport ssh {
                bird private key "/home/birdgeek/.ssh/id_rsa";
                remote public key "/home/birdgeek/.ssh/known_hosts";
                user "birdgeek";
        };

        # Default interval values
}
</PRE>
<HR>
<P>
<P>
<H2><A NAME="static"></A> <A NAME="ss6.14">6.14</A> <A HREF="bird.html#toc6.14">Static</A>
</H2>

<P>The Static protocol doesn't communicate with other routers in the network,
but instead it allows you to define routes manually. This is often used for
specifying how to forward packets to parts of the network which don't use
dynamic routing at all and also for defining sink routes (i.e., those telling to
return packets as undeliverable if they are in your IP block, you don't have any
specific destination for them and you don't want to send them out through the
default route to prevent routing loops).
<P>
<P>There are three classes of definitions in Static protocol configuration --
global options, static route definitions, and per-route options. Usually, the
definition of the protocol contains mainly a list of static routes.
Static routes have no specific attributes.
<P>
<P>Global options:
<P>
<DL>
<DT><CODE>
<A NAME="static-check-link"></A> check link <I>switch</I></CODE><DD><P>If set, hardware link states of network interfaces are taken into
consideration.  When link disappears (e.g. ethernet cable is unplugged),
static routes directing to that interface are removed. It is possible
that some hardware drivers or platforms do not implement this feature.
Default: off.
<P>
<DT><CODE>
<A NAME="static-igp-table"></A> igp table <I>name</I></CODE><DD><P>Specifies a table that is used for route table lookups of recursive
routes. Default: the same table as the protocol is connected to.
</DL>
<P>
<P>Route definitions (each may also contain a block of per-route options):
<P>
<H3>Regular routes; MPLS switching rules</H3>

<P>There exist several types of routes; keep in mind that <I>prefix</I> syntax is
<A HREF="bird-5.html#type-prefix">dependent on network type</A>.
<P>
<DL>
<DT><CODE>route <I>prefix</I> via <I>ip</I>|<I>"interface"</I> [mpls <I>num</I>[/<I>num</I>[/<I>num</I>[...]]]]</CODE><DD><P>Next hop routes may bear one or more 
<A HREF="bird-2.html#route-next-hop">next hops</A>.
Every next hop is preceded by <CODE>via</CODE> and configured as shown.
<P>
<DT><CODE>route <I>prefix</I> recursive <I>ip</I> [mpls <I>num</I>[/<I>num</I>[/<I>num</I>[...]]]]</CODE><DD><P>Recursive nexthop resolves the given IP in the configured IGP table and
uses that route's next hop. The MPLS stacks are concatenated; on top is
the IGP's nexthop stack and on bottom is this route's stack.
<P>
<DT><CODE>route <I>prefix</I> blackhole|unreachable|prohibit</CODE><DD><P>Special routes specifying to silently drop the packet, return it as
unreachable or return it as administratively prohibited. First two
targets are also known as <CODE>drop</CODE> and <CODE>reject</CODE>.
</DL>
<P>
<P>When the particular destination is not available (the interface is down or
the next hop of the route is not a neighbor at the moment), Static just
uninstalls the route from the table it is connected to and adds it again as soon
as the destination becomes adjacent again.
<P>
<H3>Route Origin Authorization</H3>

<P>The ROA config is just <CODE>route <I>prefix</I> max <I>int</I> as <I>int</I></CODE> with no nexthop.
<P>
<H3><A NAME="flowspec-network-type"></A> Flowspec</H3>

<P>The flow specification are rules for routers and firewalls for filtering
purpose. It is described by <A HREF="http://www.rfc-editor.org/info/rfc5575">RFC 5575</A>. There are 3 types of arguments:
<I>inet4</I> or <I>inet6</I> prefixes, bitmasks matching expressions and numbers
matching expressions.
<P>Bitmasks matching is written using <I>value</I><CODE>/</CODE><I>mask</I> or
<CODE>!</CODE><I>value</I><CODE>/</CODE><I>mask</I> pairs. It means that <CODE>(</CODE><I>data</I> <CODE>&amp;</CODE>
<I>mask</I><CODE>)</CODE> is or is not equal to <I>value</I>.
<P>Numbers matching is a matching sequence of numbers and ranges separeted by a
commas (<CODE>,</CODE>) (e.g. <CODE>10,20,30</CODE>). Ranges can be written using double dots
<CODE>..</CODE> notation (e.g. <CODE>80..90,120..124</CODE>). An alternative notation are
sequence of one or more pairs of relational operators and values separated by
logical operators <CODE>&amp;&amp;</CODE> or <CODE>||</CODE>. Allowed relational operators are <CODE>=</CODE>,
<CODE>!=</CODE>, <CODE>&lt;</CODE>, <CODE>&lt;=</CODE>, <CODE>></CODE>, <CODE>>=</CODE>, <CODE>true</CODE> and <CODE>false</CODE>.
<P>
<H3>IPv4 Flowspec</H3>

<P>
<DL>
<DT><CODE>
<A NAME="flow-dst"></A> dst <I>inet4</I></CODE><DD><P>Set a matching destination prefix (e.g. <CODE>dst 192.168.0.0/16</CODE>).
Only this option is mandatory in IPv4 Flowspec.
<P>
<DT><CODE>
<A NAME="flow-src"></A> src <I>inet4</I></CODE><DD><P>Set a matching source prefix (e.g. <CODE>src 10.0.0.0/8</CODE>).
<P>
<DT><CODE>
<A NAME="flow-proto"></A> proto <I>numbers-match</I></CODE><DD><P>Set a matching IP protocol numbers (e.g.  <CODE>proto 6</CODE>).
<P>
<DT><CODE>
<A NAME="flow-port"></A> port <I>numbers-match</I></CODE><DD><P>Set a matching source or destination TCP/UDP port numbers (e.g.
<CODE>port 1..1023,1194,3306</CODE>).
<P>
<DT><CODE>
<A NAME="flow-dport"></A> dport <I>numbers-match</I></CODE><DD><P>Set a mating destination port numbers (e.g. <CODE>dport 49151</CODE>).
<P>
<DT><CODE>
<A NAME="flow-sport"></A> sport <I>numbers-match</I></CODE><DD><P>Set a matching source port numbers (e.g. <CODE>sport = 0</CODE>).
<P>
<DT><CODE>
<A NAME="flow-icmp-type"></A> icmp type <I>numbers-match</I></CODE><DD><P>Set a matching type field number of an ICMP packet (e.g. <CODE>icmp type
3</CODE>)
<P>
<DT><CODE>
<A NAME="flow-icmp-code"></A> icmp code <I>numbers-match</I></CODE><DD><P>Set a matching code field number of an ICMP packet (e.g. <CODE>icmp code
1</CODE>)
<P>
<DT><CODE>
<A NAME="flow-tcp-flags"></A> tcp flags <I>bitmask-match</I></CODE><DD><P>Set a matching bitmask for TCP header flags (aka control bits) (e.g.
<CODE>tcp flags 0x03/0x0f;</CODE>). The maximum length of mask is 12 bits
(0xfff).
<P>
<DT><CODE>
<A NAME="flow-length"></A> length <I>numbers-match</I></CODE><DD><P>Set a matching packet length (e.g. <CODE>length > 1500;</CODE>)
<P>
<DT><CODE>
<A NAME="flow-dscp"></A> dscp <I>numbers-match</I></CODE><DD><P>Set a matching DiffServ Code Point number (e.g. <CODE>length > 1500;</CODE>).
<P>
<DT><CODE>
<A NAME="flow-fragment"></A> fragment <I>fragmentation-type</I></CODE><DD><P>Set a matching type of packet fragmentation. Allowed fragmentation
types are <CODE>dont_fragment</CODE>, <CODE>is_fragment</CODE>, <CODE>first_fragment</CODE>,
<CODE>last_fragment</CODE> (e.g. <CODE>fragment is_fragment &amp;&amp;
!dont_fragment</CODE>).
</DL>
<P>
<P>
<HR>
<PRE>
protocol static {
        flow4;

        route flow4 {
                dst 10.0.0.0/8;
                port > 24 &amp;&amp; &lt; 30 || 40..50,60..70,80 &amp;&amp; >= 90;
                tcp flags 0x03/0x0f;
                length > 1024;
                dscp = 63;
                fragment dont_fragment, is_fragment || !first_fragment;
        };
}
</PRE>
<HR>
<P>
<H3>Differences for IPv6 Flowspec</H3>

<P>Flowspec IPv6 are same as Flowspec IPv4 with a few exceptions.
<UL>
<LI>Prefixes <I>inet6</I> can be specified not only with prefix length,
but with prefix <CODE>offset</CODE> <I>num</I> too (e.g.
<CODE>::1234:5678:9800:0000/101 offset 64</CODE>). Offset means to don't
care of <I>num</I> first bits.</LI>
<LI>IPv6 Flowspec hasn't mandatory any flowspec component.</LI>
<LI>In IPv6 packets, there is a matching the last next header value
for a matching IP protocol number (e.g. <CODE>next header 6</CODE>).</LI>
<LI>It is not possible to set <CODE>dont_fragment</CODE> as a type of
packet fragmentation.</LI>
</UL>
<P>
<P>
<DL>
<DT><CODE>
<A NAME="flow6-dst"></A> dst <I>inet6</I> [offset <I>num</I>]</CODE><DD><P>Set a matching destination IPv6 prefix (e.g. <CODE>dst
::1c77:3769:27ad:a11a/128 offset 64</CODE>).
<P>
<DT><CODE>
<A NAME="flow6-src"></A> src <I>inet6</I> [offset <I>num</I>]</CODE><DD><P>Set a matching source IPv6 prefix (e.g. <CODE>src fe80::/64</CODE>).
<P>
<DT><CODE>
<A NAME="flow6-next-header"></A> next header <I>numbers-match</I></CODE><DD><P>Set a matching IP protocol numbers (e.g. <CODE>next header != 6</CODE>).
<P>
<DT><CODE>
<A NAME="flow6-label"></A> label <I>bitmask-match</I></CODE><DD><P>Set a 20-bit bitmask for matching Flow Label field in IPv6 packets
(e.g. <CODE>label 0x8e5/0x8e5</CODE>).
</DL>
<P>
<P>
<HR>
<PRE>
protocol static {
        flow6 { table myflow6; };

        route flow6 {
                dst fec0:1122:3344:5566:7788:99aa:bbcc:ddee/128;
                src 0000:0000:0000:0001:1234:5678:9800:0000/101 offset 63;
                next header = 23;
                sport > 24 &amp;&amp; &lt; 30 || = 40 || 50,60,70..80;
                dport = 50;
                tcp flags 0x03/0x0f, !0/0xff || 0x33/0x33;
                fragment !is_fragment || !first_fragment;
                label 0xaaaa/0xaaaa &amp;&amp; 0x33/0x33;
        };
}
</PRE>
<HR>
<P>
<H3>Per-route options</H3>

<P>
<DL>
<DT><CODE>
<A NAME="static-route-bfd"></A> bfd <I>switch</I></CODE><DD><P>The Static protocol could use BFD protocol for next hop liveness
detection. If enabled, a BFD session to the route next hop is created
and the static route is BFD-controlled -- the static route is announced
only if the next hop liveness is confirmed by BFD. If the BFD session
fails, the static route is removed. Note that this is a bit different
compared to other protocols, which may use BFD as an advisory mechanism
for fast failure detection but ignores it if a BFD session is not even
established.
<P>This option can be used for static routes with a direct next hop, or
also for for individual next hops in a static multipath route (see
above). Note that BFD protocol also has to be configured, see
<A HREF="#bfd">BFD</A> section for details. Default value is no.
<P>
<DT><CODE>
<A NAME="static-route-filter"></A> <I>filter expression</I></CODE><DD><P>This is a special option that allows filter expressions to be configured
on per-route basis. Can be used multiple times. These expressions are
evaluated when the route is originated, similarly to the import filter
of the static protocol. This is especially useful for configuring route
attributes, e.g., <CODE>ospf_metric1 = 100;</CODE> for a route that will be
exported to the OSPF protocol.
</DL>
<P>
<H3>Example static config</H3>

<P>
<HR>
<PRE>
protocol static {
        ipv4 { table testable; };       # Connect to a non-default routing table
        check link;                     # Advertise routes only if link is up
        route 0.0.0.0/0 via 198.51.100.130; # Default route
        route 10.0.0.0/8                # Multipath route
                via 198.51.100.10 weight 2
                via 198.51.100.20 bfd   # BFD-controlled next hop
                via 192.0.2.1;
        route 203.0.113.0/24 unreachable; # Sink route
        route 10.2.0.0/24 via "arc0";   # Secondary network
        route 192.168.10.0/24 via 198.51.100.100 {
                ospf_metric1 = 20;      # Set extended attribute
        }
        route 192.168.10.0/24 via 198.51.100.100 {
                ospf_metric2 = 100;     # Set extended attribute
                ospf_tag = 2;           # Set extended attribute
                bfd;                    # BFD-controlled route
        }
}
</PRE>
<HR>
<P>
<P>
<HR>
<A HREF="bird-7.html">Next</A>
<A HREF="bird-5.html">Previous</A>
<A HREF="bird.html#toc6">Contents</A>
</BODY>
</HTML>
